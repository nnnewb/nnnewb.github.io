<!doctype html><html lang=zh><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>gokit æ¶æ„ä¹‹æˆ‘è§</title><meta content="gokit æ¶æ„ä¹‹æˆ‘è§" name=title><meta content=ä¸€ç‚¹ç‚¹ä»è¿™ä¸ªä¸–ç•Œä¸Šæ¶ˆå¤±ã€‚ name=description><meta content=website property=og:type><meta content=https://nnnewb.github.io/posts/2022/my-opinion-of-gokit-architecture/ property=og:url><meta content="weakptr's blog" property=og:site_name><meta content="gokit æ¶æ„ä¹‹æˆ‘è§" property=og:title><meta content=ä¸€ç‚¹ç‚¹ä»è¿™ä¸ªä¸–ç•Œä¸Šæ¶ˆå¤±ã€‚ property=og:description><meta content=https://nnnewb.github.io/image/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://nnnewb.github.io/posts/2022/my-opinion-of-gokit-architecture/ property=twitter:url><meta content="gokit æ¶æ„ä¹‹æˆ‘è§" property=twitter:title><meta content=ä¸€ç‚¹ç‚¹ä»è¿™ä¸ªä¸–ç•Œä¸Šæ¶ˆå¤±ã€‚ property=twitter:description><meta content=https://nnnewb.github.io/image/favicon.ico property=twitter:image><link href=https://nnnewb.github.io/posts/2022/my-opinion-of-gokit-architecture/ rel=canonical><link rel="shortcut icon" href=https://nnnewb.github.io/image/favicon.ico type=image/x-icon><link href=https://nnnewb.github.io/css/reset.css rel=stylesheet><link href=https://nnnewb.github.io/css/pallete.css rel=stylesheet><link href=https://nnnewb.github.io/css/suCSS.css rel=stylesheet><link href=https://nnnewb.github.io/archive.css rel=stylesheet><link href=https://nnnewb.github.io/style.css rel=stylesheet><script defer src=https://nnnewb.github.io/js/script.js></script><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y rel=stylesheet><script crossorigin defer integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js></script><script crossorigin defer integrity=sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js></script><script crossorigin defer integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            // customised options
            // â€¢ auto-render specific keys, e.g.:
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: false }
            ],
            // â€¢ rendering keys, e.g.:
            throwOnError: true
        });
    });</script><script src=https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js></script><script>document.addEventListener('DOMContentLoaded', function () {
        // æŸ¥æ‰¾æ‰€æœ‰å…·æœ‰ 'pre' æ ‡ç­¾ä¸”ç±»åä¸º 'language-mermaid' çš„å…ƒç´ 
        const mermaidElements = document.getElementsByClassName('language-mermaid');
        for (let i = 0; i < mermaidElements.length; i++) {
            const el = mermaidElements.item(i);
            if (el.tagName === "PRE" && !el.classList.contains('mermaid')) {
                el.innerHTML = el.textContent;
                el.classList.add('mermaid');
            }
        }

        mermaid.initialize({ startOnLoad: true, theme: 'dark', });
    })</script><script>if (window.location.hostname.toLowerCase() !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?dbb9df33a2de52aede8bccd84a7493ad";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    }</script><link href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Medium/result.css rel=stylesheet><link href=https://chinese-fonts-cdn.deno.dev/packages/maple-mono-cn/dist/MapleMono-CN-Regular/result.css rel=stylesheet><body><header><nav id=nav-bar><a href=/> é¦–é¡µ </a> â€‚/â€‚ <a href=/posts/> æ–‡ç«  </a> â€‚/â€‚ <a href=/categories/> åˆ†ç±» </a> â€‚/â€‚ <a href=/tags/> æ ‡ç­¾ </a> â€‚/â€‚ <a href=/search/> æœç´¢ </a> â€‚/â€‚ <div><input id=theme-toggle style=display:none type=checkbox><label for=theme-toggle id=theme-toggle-label><svg class=icons id=theme-icon><use href=https://nnnewb.github.io/icons.svg#lightMode></use></svg></label><audio id=theme-sound><source src=https://nnnewb.github.io/click.ogg type=audio/ogg></audio></div></nav></header><main><h1>gokit æ¶æ„ä¹‹æˆ‘è§</h1><p class=author-line>ä½œäºï¼š2022-03-02 12:30 ï¼Œé¢„è®¡é˜…è¯»æ—¶é—´ 9 åˆ†é’Ÿ<article><h2 id=qian-yan>å‰è¨€</h2><p>è¿™æ˜¯çœ‹äº† <a href=https://github.com/go-kit/kit/issues/843>Go kit: the road ahead</a> ä¹‹åï¼Œå¯¹ go kit è¿™å¥—æŠ½è±¡çš„ä¸€äº›æƒ³æ³•ã€‚ä¸»è¦æ˜¯å…³äº endpoint æ˜¯å¦æœ‰å¿…è¦ã€generic ä¼šå¦‚ä½•å½±å“ go kit çš„æ¶æ„ã€go kit çš„ä»£ç ç”Ÿæˆè¿™äº›é—®é¢˜ã€‚<h2 id=endpoint-chou-xiang-ceng-shi-fou-bi-yao-cun-zai>endpoint æŠ½è±¡å±‚æ˜¯å¦å¿…è¦å­˜åœ¨</h2><p>æˆ‘çš„çœ‹æ³•æ˜¯éœ€è¦ã€‚åŸå› ä¸‹é¢åˆ†æã€‚<p>ä¸€ä¸ªæ²¡æœ‰é¢å¤–åŠŸèƒ½çš„ Endpoint å…¶å®æ˜¯èµ·åˆ°äº†æŠŠè¯·æ±‚ç±»å‹é€‚é…åˆ° Go å‡½æ•°ç­¾åçš„ä½œç”¨ã€‚<a href=http://gokit.io/examples/stringsvc.html#endpoints>stringsvc</a> å®ç°å¦‚ä¸‹ã€‚<pre class=language-go data-lang=go style=color:#fdf4c1aa;background-color:#282828><code class=language-go data-lang=go><span style=color:#fa5c4b>import </span><span>(
</span><span>	</span><span style=color:#b8bb26>"context"
</span><span>	</span><span style=color:#b8bb26>"github.com/go-kit/kit/endpoint"
</span><span>)
</span><span>
</span><span style=color:#fa5c4b>func </span><span style=color:#8ec07c>makeUppercaseEndpoint</span><span>(</span><span style=color:#fdf4c1>svc </span><span style=color:#fa5c4b>StringService</span><span>) </span><span style=color:#fdf4c1>endpoint</span><span>.</span><span style=color:#fa5c4b>Endpoint </span><span>{
</span><span>	</span><span style=color:#fa5c4b>return func</span><span>(</span><span style=color:#fdf4c1>_ context</span><span>.</span><span style=color:#fa5c4b>Context</span><span>, </span><span style=color:#fdf4c1>request </span><span style=color:#fa5c4b>interface</span><span>{}) (</span><span style=color:#fa5c4b>interface</span><span>{}, </span><span style=color:#fabd2f>error</span><span>) {
</span><span>		</span><span style=color:#fdf4c1>req </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>request</span><span>.(</span><span style=color:#fa5c4b>uppercaseRequest</span><span>)
</span><span>		</span><span style=color:#fdf4c1>v</span><span>, </span><span style=color:#fdf4c1>err </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>svc</span><span>.</span><span style=color:#fdf4c1>Uppercase</span><span>(</span><span style=color:#fdf4c1>req</span><span>.</span><span style=color:#fdf4c1>S</span><span>)
</span><span>		</span><span style=color:#fa5c4b>if </span><span style=color:#fdf4c1>err </span><span style=color:#fe8019>!= </span><span style=color:#d3869b>nil </span><span>{
</span><span>			</span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>uppercaseResponse</span><span>{</span><span style=color:#fdf4c1>v</span><span>, </span><span style=color:#fdf4c1>err</span><span>.</span><span style=color:#fdf4c1>Error</span><span>()}, </span><span style=color:#d3869b>nil
</span><span>		}
</span><span>		</span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>uppercaseResponse</span><span>{</span><span style=color:#fdf4c1>v</span><span>, </span><span style=color:#b8bb26>""</span><span>}, </span><span style=color:#d3869b>nil
</span><span>	}
</span><span>}
</span><span>
</span><span style=color:#fa5c4b>func </span><span style=color:#8ec07c>makeCountEndpoint</span><span>(</span><span style=color:#fdf4c1>svc </span><span style=color:#fa5c4b>StringService</span><span>) </span><span style=color:#fdf4c1>endpoint</span><span>.</span><span style=color:#fa5c4b>Endpoint </span><span>{
</span><span>	</span><span style=color:#fa5c4b>return func</span><span>(</span><span style=color:#fdf4c1>_ context</span><span>.</span><span style=color:#fa5c4b>Context</span><span>, </span><span style=color:#fdf4c1>request </span><span style=color:#fa5c4b>interface</span><span>{}) (</span><span style=color:#fa5c4b>interface</span><span>{}, </span><span style=color:#fabd2f>error</span><span>) {
</span><span>		</span><span style=color:#fdf4c1>req </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>request</span><span>.(</span><span style=color:#fa5c4b>countRequest</span><span>)
</span><span>		</span><span style=color:#fdf4c1>v </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>svc</span><span>.</span><span style=color:#fdf4c1>Count</span><span>(</span><span style=color:#fdf4c1>req</span><span>.</span><span style=color:#fdf4c1>S</span><span>)
</span><span>		</span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>countResponse</span><span>{</span><span style=color:#fdf4c1>v</span><span>}, </span><span style=color:#d3869b>nil
</span><span>	}
</span><span>}
</span></code></pre><p>å¯¹äºå†™è¿‡ rpcx æˆ–è€… gRPC çš„æœ‹å‹æ¥è¯´ï¼ŒEndpoint æ›´åƒæ˜¯ä¸ªè„±è£¤å­æ”¾å±çš„å°è£…ã€‚åªè¦æŠŠæ¥å£å‚æ•°çº¦å®šæˆ <code>func (ctx context.Context, req interface{}) (interface{}, error)</code> ä¸å°±å®Œäº†ï¼Ÿä¼ è¾“å±‚æ”¶åˆ°çš„è¯·æ±‚è§£ç æˆæœ¬åœ°æ•°æ®ç±»å‹ï¼Œç„¶åæŒ‰çº¦å®šä¼ å…¥ï¼Œå°±ä¸‡äº‹å¤§å‰äº†ã€‚<p>ç©ºå£æ— å‡­ï¼Œä¸å¦‚çœ‹çœ‹å¦‚æœä¸è¦ endpointï¼Œå®é™…ç¼–å†™çš„ä»£ç ä¼šå˜æˆä»€ä¹ˆæ ·ã€‚<p>åƒæ˜¯ go kit æä¾›çš„è¿™ç§å¸®åŠ©å‡½æ•°ï¼š<pre class=language-go data-lang=go style=color:#fdf4c1aa;background-color:#282828><code class=language-go data-lang=go><span style=color:#fdf4c1>uppercaseHandler </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>httptransport</span><span>.</span><span style=color:#fdf4c1>NewServer</span><span>(
</span><span>    </span><span style=color:#fdf4c1>makeUppercaseEndpoint</span><span>(</span><span style=color:#fdf4c1>svc</span><span>),
</span><span>    </span><span style=color:#fdf4c1>decodeUppercaseRequest</span><span>,
</span><span>    </span><span style=color:#fdf4c1>encodeResponse</span><span>,
</span><span>)
</span><span>
</span><span style=color:#fdf4c1>countHandler </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>httptransport</span><span>.</span><span style=color:#fdf4c1>NewServer</span><span>(
</span><span>    </span><span style=color:#fdf4c1>makeCountEndpoint</span><span>(</span><span style=color:#fdf4c1>svc</span><span>),
</span><span>    </span><span style=color:#fdf4c1>decodeCountRequest</span><span>,
</span><span>    </span><span style=color:#fdf4c1>encodeResponse</span><span>,
</span><span>)
</span></code></pre><p>å¯èƒ½å°±ä¼šå˜æˆè¿™æ ·ï¼š<pre class=language-go data-lang=go style=color:#fdf4c1aa;background-color:#282828><code class=language-go data-lang=go><span style=color:#fdf4c1>uppercaseHandler </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>httptransport</span><span>.</span><span style=color:#fdf4c1>NewServer</span><span>(
</span><span>    </span><span style=color:#fdf4c1>svc</span><span>.</span><span style=color:#fdf4c1>Uppercase</span><span>,
</span><span>    </span><span style=color:#fdf4c1>decodeUppercaseRequest</span><span>,
</span><span>    </span><span style=color:#fdf4c1>encodeResponse</span><span>,
</span><span>)
</span><span>
</span><span style=color:#fdf4c1>countHandler </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>httptransport</span><span>.</span><span style=color:#fdf4c1>NewServer</span><span>(
</span><span>    </span><span style=color:#fdf4c1>svc</span><span>.</span><span style=color:#fdf4c1>Count</span><span>,
</span><span>    </span><span style=color:#fdf4c1>decodeCountRequest</span><span>,
</span><span>    </span><span style=color:#fdf4c1>encodeResponse</span><span>,
</span><span>)
</span></code></pre><p>å½“ç„¶ï¼Œä¸ºäº†è®© Go è¯­è¨€çš„ç±»å‹ç³»ç»Ÿå¼€å¿ƒï¼Œè¿™é‡Œçš„ <code>svc.Uppercase</code> å’Œ <code>svc.Count</code> å¾—æ˜¯ä¸€æ ·çš„ç­¾åï¼Œæˆ–è€…ç”¨ <code>interface{}</code> åšå½¢å‚ï¼Œåˆæˆ–è€…è€ƒè™‘è¿˜æ²¡æœ‰å‘å¸ƒçš„æ³›å‹èƒ½ä¸èƒ½æ”¯æŒã€‚<p>çœ‹èµ·æ¥æ˜¯èˆ’æœäº†å¾ˆå¤šå¯¹å§ï¼ŸEndpoint æ²¡äº†ã€‚ä½†è¿˜æœ‰ä¸ªé—®é¢˜ï¼šä¸­é—´ä»¶ã€‚è¦æ€ä¹ˆå®ç°é€šç”¨çš„ä¸­é—´ä»¶ï¼Œåº”ç”¨åœ¨æ¯ä¸ªåŸæœ¬åº”è¯¥æ˜¯ Endpoint çš„åœ°æ–¹ï¼Ÿ<p>ä¾‹å¦‚åœ¨å¾®æœåŠ¡ç³»ç»Ÿé‡Œå¾ˆå¸¸è§çš„åˆ†å¸ƒå¼è·Ÿè¸ªã€metricsæ”¶é›†ï¼Œæ— è®ºæœ€ç»ˆé‡‡ç”¨çš„æ˜¯ opentracingã€opencecusã€opentelemetry è¿˜æ˜¯ zipkinã€prometheusï¼Œè·Ÿè¸ªè°ƒç”¨é“¾è·¯æ˜¯ä¸€ä¸ªå¾ˆåŸºæœ¬çš„å¯è§‚æµ‹æ€§è¦æ±‚ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥è¯´ç”¨ linkerd ä¸€ç±»çš„ service mesh è§£å†³æ–¹æ¡ˆï¼ˆè™½ç„¶æˆ‘è§‰å¾—ä¸èƒ½æ›¿ä»£ä¸Šé¢æåˆ°çš„è¿™äº›ä¸œè¥¿ï¼‰ï¼Œä½†ä¹Ÿåº”è¯¥æœ‰æ‰€è­¦æƒ•ï¼šæˆ‘ä»¬æ˜¯ä¸æ˜¯è¿˜æœ‰éœ€è¦åœ¨æ¯ä¸ªæ¥å£ä¸Šéƒ½æ‰§è¡Œã€å’Œä¼ è¾“å±‚æ— å…³çš„ä»£ç ï¼Ÿå¯¹ï¼Œè¿˜æœ‰èº«ä»½éªŒè¯å’Œé‰´æƒå·¥ä½œã€‚è¿˜æœ‰å—ï¼Ÿ<p>å½“ç„¶ï¼Œä¹Ÿä¸æ˜¯è„±ç¦»äº† Endpoint å°±åˆ«æ— ä»–æ³•ï¼Œåªæ˜¯åœ¨éœ€è¦çš„æ—¶å€™ï¼Œæˆ‘æƒ³æ€»è¿˜æ˜¯ä¼šæœ‰æ„æ— æ„æŠ½è±¡å‡ºä¸€ä¸ªç±»ä¼¼ endpoint çš„å±‚çº§â€”â€”å¯èƒ½éšè—åœ¨ service ä¸­é—´ä»¶é‡Œï¼Œä¹Ÿå¯èƒ½äº¤ç»™äº†ä¼ è¾“å±‚ã€‚å¯èƒ½å†™å¾—æ›´å¥½ï¼Œä¹Ÿå¯èƒ½åˆæ˜¯åœ¨å †å±å±±ã€‚ç»éªŒå‘Šè¯‰æˆ‘åœ¨ä¸€ä¸ªéœ€è¦é•¿æœŸæ”¯æŒçš„ç³»ç»Ÿé‡Œï¼Œäººæ˜¯é ä¸ä½çš„ï¼Œä½†è§„èŒƒå¯ä»¥ã€‚endpoint å¹¶æ²¡æœ‰ç‰ºç‰²å¤šå°‘ç¼–ç ä¸Šçš„è‡ªç”±åº¦ï¼Œä½†ä¸€å®šç¨‹åº¦ä¸Šé¿å…äº†æ½œåœ¨çš„å †å±å¯èƒ½ï¼Œæˆ‘è§‰å¾—å®Œå…¨å¯ä»¥æ¥å—ã€‚<h2 id=generic-hui-ru-he-ying-xiang-go-kit-jia-gou>generic ä¼šå¦‚ä½•å½±å“ go kit æ¶æ„</h2><p>æˆ‘ç›´è¯´ï¼ŒGo çš„æ³›å‹ï¼ˆbeta1ï¼‰å°±æ˜¯ä¸€æ³¡ç‹—å±ï¼Œæˆ‘å‘æ¥ä¸å–œæ¬¢ Go å›¢é˜Ÿçš„å“å‘³ï¼Œä» slice å’Œ interface{} æ³„éœ²è¯­è¨€çš„å®ç°ç»†èŠ‚åˆ°å…¶ä»–æ›´ç¦»è°±çš„ä¸œè¥¿ã€‚ä½†ç°åœ¨ Go æ³›å‹è¿˜æ²¡æœ‰æ­£å¼å…¬å¸ƒï¼ˆé¢„æœŸå°±åœ¨æœ¬æœˆï¼‰ï¼Œç°åœ¨æˆ‘ä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯„è®ºçš„ã€‚<p>generic ä¼šå½±å“ go kit çš„æ¶æ„å—ï¼Ÿæˆ‘çš„çœ‹æ³•æ˜¯ä¸ä¼šã€‚æ³›å‹ä¹Ÿè®¸èƒ½æå¤§å¸®åŠ©å„ç§å®¹å™¨ç±»å‹ã€è¿­ä»£å™¨ä¹‹ç±»é¥±å— <code>interface{}</code> æŠ˜ç£¨çš„ç»„ä»¶ï¼Œä½†æ˜¯ go kit ç”¨å¾—ä¸Šæ³›å‹çš„åœ°æ–¹å…¶å®ä¸å¤šã€‚å°‘æ•°å¸¸è§çš„ <code>interface{}</code> åœºåˆï¼Œéƒ½æ˜¯åœ¨ä»ä¸€ä¸ªç±»å‹é€‚é…åˆ°å¦ä¸€ä¸ªç±»å‹ï¼Œä»£ç ç¼–å†™è€…æ¸…æ¥šè‡ªå·±è¦å¤„ç†çš„ä¸¤ä¸ªç±»å‹ï¼Œä½† go kit ä¸çŸ¥é“ã€‚<pre class=language-go data-lang=go style=color:#fdf4c1aa;background-color:#282828><code class=language-go data-lang=go><span style=color:#fa5c4b>func </span><span style=color:#8ec07c>makeUppercaseEndpoint</span><span>(</span><span style=color:#fdf4c1>svc </span><span style=color:#fa5c4b>StringService</span><span>) </span><span style=color:#fdf4c1>endpoint</span><span>.</span><span style=color:#fa5c4b>Endpoint </span><span>{
</span><span>	</span><span style=color:#fa5c4b>return func</span><span>(</span><span style=color:#fdf4c1>_ context</span><span>.</span><span style=color:#fa5c4b>Context</span><span>, </span><span style=color:#fdf4c1>request </span><span style=color:#fa5c4b>interface</span><span>{}) (</span><span style=color:#fa5c4b>interface</span><span>{}, </span><span style=color:#fabd2f>error</span><span>) {
</span><span>		</span><span style=color:#fdf4c1>req </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>request</span><span>.(</span><span style=color:#fa5c4b>uppercaseRequest</span><span>)
</span><span>		</span><span style=color:#fdf4c1>v</span><span>, </span><span style=color:#fdf4c1>err </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>svc</span><span>.</span><span style=color:#fdf4c1>Uppercase</span><span>(</span><span style=color:#fdf4c1>req</span><span>.</span><span style=color:#fdf4c1>S</span><span>)
</span><span>		</span><span style=color:#fa5c4b>if </span><span style=color:#fdf4c1>err </span><span style=color:#fe8019>!= </span><span style=color:#d3869b>nil </span><span>{
</span><span>			</span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>uppercaseResponse</span><span>{</span><span style=color:#fdf4c1>v</span><span>, </span><span style=color:#fdf4c1>err</span><span>.</span><span style=color:#fdf4c1>Error</span><span>()}, </span><span style=color:#d3869b>nil
</span><span>		}
</span><span>		</span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>uppercaseResponse</span><span>{</span><span style=color:#fdf4c1>v</span><span>, </span><span style=color:#b8bb26>""</span><span>}, </span><span style=color:#d3869b>nil
</span><span>	}
</span><span>}
</span></code></pre><p>è¿™éƒ¨åˆ†é€‚é…ä»£ç å¦‚æœæŠŠ <code>interface{}</code> æ›¿æ¢æˆå…·ä½“çš„ <code>uppercaseRequest</code> å’Œ <code>uppercaseResponse</code> çš„è¯ï¼Œå°±éœ€è¦ go kit æä¾›æ³›å‹å½¢å¼çš„ Endpoint æ¥å£äº†ï¼Œåƒæ˜¯è¿™æ ·ï¼š<pre class=language-go data-lang=go style=color:#fdf4c1aa;background-color:#282828><code class=language-go data-lang=go><span style=color:#fa5c4b>type </span><span style=color:#8ec07c>Endpoint</span><span>[</span><span style=color:#fdf4c1>RequestType</span><span>,</span><span style=color:#fdf4c1>ResponseType</span><span>] </span><span style=color:#fe8019>= </span><span style=color:#fa5c4b>func</span><span>(</span><span style=color:#fdf4c1>context</span><span>.</span><span style=color:#fa5c4b>Context</span><span>, </span><span style=color:#fa5c4b>RequestType</span><span>) (</span><span style=color:#fa5c4b>ResponseType</span><span>, </span><span style=color:#fabd2f>error</span><span>)
</span></code></pre><p>ä¸Šé¢çš„ä»£ç æœ‰æ•ˆæ— æ•ˆå…ˆä¸è¯´ï¼Œæˆ‘è®°å¾—åœ¨ beta1 å°è¯•æ³›å‹çš„æ—¶å€™å‘ç° Go åœ¨æ¨æ–­ç±»å‹çš„æ—¶å€™å­˜åœ¨é—®é¢˜ï¼Œè¿™ä¸ª <code>RequestType</code> å’Œ <code>ResponseType</code> åœ¨å®é™…ç”¨çš„æ—¶å€™æ€•æ˜¯è¦å†™ä¸æ­¢ä¸€æ¬¡ã€‚åˆæ˜¯ Go ç‰¹è‰²çš„å•°å—¦ã€‚<p>å¯å³ä¾¿æ˜¯è¿™æ ·ææ€•è¿˜æœ‰é—®é¢˜ï¼Œå¦‚æœä¿®æ”¹äº† <code>Endpoint</code> çš„ç­¾åï¼Œé‚£ä¹ˆ <code>endpoint.Middleware</code> ææ€•ä¹Ÿè¦æ³›å‹åŒ–ï¼ŒåŸæ¥çš„æ‰€æœ‰ä¸­é—´ä»¶åº“ï¼Œ<code>trace</code>ã€<code>auth</code>ã€<code>metrics</code> å¯èƒ½ä¹Ÿå¾—åšæ³›å‹åŒ–æ”¹é€ ã€‚å¯¹ä¸€ä¸ªå·²ç»æ·±åº¦å¼€å‘è¿‡çš„ç³»ç»Ÿæ¥è¯´ï¼Œä¸ºäº†è¿™ä¸€ç‚¹ç±»å‹æ£€æŸ¥çš„å¥½å¤„ä»˜å‡ºå¦‚æ­¤ä»£ä»·ææ€•æ˜¯ä¸èƒ½æ¥å—çš„ã€‚<p>æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘çš„è§‚ç‚¹æ˜¯ Generic å¯èƒ½å¸¦æ¥å˜åŒ–ï¼Œä½†æ ¹æœ¬ä¸Šçš„å‡ ä¸ªæŠ½è±¡ä¸å¤§å¯èƒ½è·Ÿç€é‡æ„ï¼Œè¿™æ˜¯ç”± go kit æ€§è´¨å†³å®šçš„ã€‚<h2 id=go-kit-dai-ma-sheng-cheng>go kit ä»£ç ç”Ÿæˆ</h2><p>ä½†å‡¡è·Ÿç€ go kit å†™è¿‡ä¸€ä¸ª stringsvc çš„äººéƒ½ä¼šæ„Ÿè§‰åˆ° go kit æœ‰å¤šå°‘æ ·æ¿ä»£ç ï¼Œé€‚é…ä¼ è¾“å±‚éœ€è¦ç¼–å†™ encode/decodeï¼Œæœ¬åœ°ç»“æ„è½¬å‡½æ•°ç­¾åæ‰€éœ€çš„å‚æ•°åˆè¦ä¸€æ¬¡è½¬æ¢ï¼Œä¼ è¾“å±‚åè®®ç›‘å¬ã€æ³¨å†Œ<code>Handler</code>ã€å®¢æˆ·ç«¯è¿æ¥éƒ½è¦è‡ªå·±ç¼–å†™ä»£ç ï¼Œæ„é€ å’Œæ³¨å†Œ <code>Endpoint</code> å¤æ‚æ€§æ— éæ˜¯ä» <code>func main</code> ç§»åŠ¨åˆ° <code>transport</code> æˆ–è€…åè¿‡æ¥ï¼Œå°½ç®¡å¾ˆçƒ¦ï¼Œä½†åˆæ— æ³•æ ¹æœ¬ä¸Šæ¶ˆé™¤ã€‚<p>å¦‚æœæ˜¯ C++ ææ€•ä¼šæœ‰æ¨¡æ¿å…ƒç¼–ç¨‹å¤§ä½¬æ™’è‡ªå·±çš„ <code>template</code>ï¼Œä½† Go åŸºæœ¬æ²¡æœ‰ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶çš„å…ƒç¼–ç¨‹èƒ½åŠ›ã€‚å”¯ä¸€æ¯”è¾ƒæ“…é•¿çš„å°±åªæœ‰ä¸ªä»£ç ç”Ÿæˆäº†ã€‚Go æä¾›çš„ <code>ast/parser</code> åŒ…å¾ˆèµï¼Œåˆ«çš„è¯­è¨€å°‘æœ‰æä¾›è¿™ä¹ˆæ–¹ä¾¿çš„æ¥å£çš„ã€‚<p>go kit çš„ä»£ç ç”Ÿæˆï¼Œä»ç›®å‰ä½“éªŒä¸­æ„Ÿå—æ¥çœ‹ï¼Œä¸»è¦æ˜¯éœ€è¦ä¸‹é¢çš„åŠŸèƒ½ï¼š<ol><li>ä» <code>interface</code> å®šä¹‰ç”Ÿæˆå¯¹åº”çš„ <code>makeEndpoint</code> å‡½æ•°å’Œè¯·æ±‚/å“åº”ç»“æ„ä½“ã€‚è¿™éƒ¨åˆ†ä»£ç åŸºæœ¬æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚<li>ä» <code>interface</code> å®šä¹‰ç”Ÿæˆå¯¹åº”çš„ <code>transport</code> åŒ…ï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©åè®®ã€‚ä¸»è¦è§£å†³ encode/decode æ‰‹å†™éº»çƒ¦çš„é—®é¢˜ã€‚<li>ä» <code>interface</code> å®šä¹‰ç”ŸæˆæœåŠ¡æ„é€ å’Œå¯åŠ¨ä»£ç ï¼Œåº”ç”¨å¯ä»¥è‡ªå·±æ„é€ ï¼Œä½† <code>endpoint</code> çš„æ„é€ å’Œ <code>middleware</code> çš„åº”ç”¨å°±å¯ä»¥ä¸ç”¨è‡ªå·±å†™äº†ã€‚</ol><p>è¿™ä¸‰å¤„çš„æ ·æ¿ä»£ç æœ€å¤šï¼Œè€Œä¸”ä»£ç æœ¬èº«å¹¶ä¸ç‰¹åˆ«ï¼Œéƒ½æ˜¯ç®€å•åœ°å¯¹ç±»å‹è¿›è¡Œé€‚é…ï¼Œæ‰‹å†™å®Œå…¨æ˜¯æµªè´¹æ—¶é—´ï¼Œè¿˜ä¼šå¼•å…¥äººä¸ºçš„ä¸ç¡®å®šæ€§ï¼Œä¸å¦‚è®©æœºå™¨æå®šã€‚ç›®å‰è€ƒå¯Ÿè¿‡çš„ <a href=https://github.com/GrantZheng/kit>kit</a> å®ç°äº†å…¶ä¸­ä¸€å¤§éƒ¨åˆ†ï¼Œä½† transport æ”¯æŒå¤ªå°‘ï¼Œä¹Ÿæ²¡æœ‰ç”Ÿæˆæ³¨å†Œ endpoint çš„ä»£ç ï¼Œä¾ç„¶å­˜åœ¨å¾ˆå¤šæ‰‹å†™çš„æ ·æ¿ä»£ç ã€‚æˆ‘ç®€å•çœ‹äº†ä¸‹å®ç°ï¼Œç”¨ <a href=https://github.com/dave/jennifer>jennifer</a> ç”Ÿæˆä»£ç å¥½æ˜¯æŒºå¥½ï¼Œå°±æ˜¯ go ä»£ç æ˜¾å¾—æœ‰ç‚¹ä¹± ...<p>æˆ‘å¯»æ€å¯¹ generator ç®€å•é‡æ„ä¸‹å®ç°å…³æ³¨ç‚¹åˆ†ç¦»çš„è¯ï¼Œè¿˜æ˜¯èƒ½æ»¡è¶³ä¸Šé¢æåˆ°çš„è¿™äº›ä¸œè¥¿çš„ã€‚æœ€å¥½çš„æƒ…å†µæ˜¯å®šä¹‰å¥½ interface ä¹‹åï¼Œç”Ÿæˆä»£ç ï¼Œç¼–å†™ä¸»å‡½æ•°ï¼Œå°±èƒ½ç›´æ¥è¿è¡Œäº†ã€‚åŒæ—¶åˆä¸ä¼¤å®³ go kit æ¶æ„æœ¬èº«çš„æ‰©å±•æ€§å’Œå¯å®šåˆ¶æ€§ã€‚<h2 id=zong-jie>æ€»ç»“</h2><p><img alt="go kitæ¶æ„çš„æœåŠ¡" src=https://nnnewb.github.io/posts/2022/my-opinion-of-gokit-architecture/image-20220302154943857.webp><p>è›®å–œæ¬¢ go kit é¡¹ç›®ä½œè€…çš„ä¸€å¥è¯ï¼š<p><img alt=issueæˆªå›¾ src=https://nnnewb.github.io/posts/2022/my-opinion-of-gokit-architecture/image-20220302155216922.webp><blockquote><p>Honestly the best way to "use" Go kit is to cop it's architectural model and not actually import any of its packages at all ğŸ˜‰</blockquote><p>å…¶å®æˆ‘ä¹Ÿæƒ³æŠŠè¿™å¥—æ¶æ„æ¬è¿›é¡¹ç›®é‡Œï¼Œå¯æƒœæ¡ä»¶ä¸å…è®¸ï¼Œè¿˜æœ‰æ›´ä¸¥é‡çš„é—®é¢˜è¦å¤„ç†ï¼Œåªèƒ½å…ˆçœ¼é¦‹ä¸€ä¸‹ï¼Œå¸æ”¶ä¸‹ç²¾ç¥ã€‚</article><p class=tags-data><a href=/tags/go-kit>/go-kit/</a> <a href=/tags/golang>/golang/</a> <a href=/tags/wei-fu-wu>/å¾®æœåŠ¡/</a></p><script data-repo-id="MDEwOlJlcG9zaXRvcnkzOTg0ODYyMTg=" async crossorigin data-category=Announcements data-category-id=DIC_kwDOF8Bqys4Cegmn data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-mapping=pathname data-reactions-enabled=1 data-repo=nnnewb/nnnewb.github.io data-strict=0 data-theme=noborder_light id=giscus_script src=https://giscus.app/client.js></script></main><footer><hr><div id=footer-container><div><p style=text-align:center>Copyright Â© 2018-2024 weakptr <a href=mailto:weak_ptr@outlook.com>&lt;weak_ptr@outlook.com></a><p style=text-align:center>Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme, <a rel="noopener noreferrer" href=https://speyll.github.io/suCSS/ target=_blank>suCSS</a> framework & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a>, modified by <a rel="noopener noreferrer" href=https://github.com/nnnewb/ target=_blank>nnnewb</a>.<p style=text-align:center>Theme and color theme licensed under <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a>.</div></div></footer>