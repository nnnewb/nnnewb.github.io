<!doctype html><html lang=zh><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>DVWA上手记录-反射型XSS</title><meta content=DVWA上手记录-反射型XSS name=title><meta content=一点点从这个世界上消失。 name=description><meta content=website property=og:type><meta content=https://nnnewb.github.io/posts/2022/get-start-dvwa-10/ property=og:url><meta content="weakptr's blog" property=og:site_name><meta content=DVWA上手记录-反射型XSS property=og:title><meta content=一点点从这个世界上消失。 property=og:description><meta content=https://nnnewb.github.io/image/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://nnnewb.github.io/posts/2022/get-start-dvwa-10/ property=twitter:url><meta content=DVWA上手记录-反射型XSS property=twitter:title><meta content=一点点从这个世界上消失。 property=twitter:description><meta content=https://nnnewb.github.io/image/favicon.ico property=twitter:image><link href=https://nnnewb.github.io/posts/2022/get-start-dvwa-10/ rel=canonical><link rel="shortcut icon" href=https://nnnewb.github.io/image/favicon.ico type=image/x-icon><link href=https://nnnewb.github.io/css/reset.css rel=stylesheet><link href=https://nnnewb.github.io/css/pallete.css rel=stylesheet><link href=https://nnnewb.github.io/css/suCSS.css rel=stylesheet><link href=https://nnnewb.github.io/archive.css rel=stylesheet><link href=https://nnnewb.github.io/style.css rel=stylesheet><script defer src=https://nnnewb.github.io/js/script.js></script><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y rel=stylesheet><script crossorigin defer integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js></script><script crossorigin defer integrity=sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js></script><script crossorigin defer integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            // customised options
            // • auto-render specific keys, e.g.:
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: false }
            ],
            // • rendering keys, e.g.:
            throwOnError: true
        });
    });</script><script src=https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js></script><script>document.addEventListener('DOMContentLoaded', function () {
        // 查找所有具有 'pre' 标签且类名为 'language-mermaid' 的元素
        const mermaidElements = document.getElementsByClassName('language-mermaid');
        for (let i = 0; i < mermaidElements.length; i++) {
            const el = mermaidElements.item(i);
            if (el.tagName === "PRE" && !el.classList.contains('mermaid')) {
                el.innerHTML = el.textContent;
                el.classList.add('mermaid');
            }
        }

        mermaid.initialize({ startOnLoad: true, theme: 'dark', });
    })</script><script>if (window.location.hostname.toLowerCase() !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?dbb9df33a2de52aede8bccd84a7493ad";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    }</script><link href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Medium/result.css rel=stylesheet><link href=https://chinese-fonts-cdn.deno.dev/packages/maple-mono-cn/dist/MapleMono-CN-Regular/result.css rel=stylesheet><body><header><nav id=nav-bar><a href=/> 首页 </a>  /  <a href=/posts/> 文章 </a>  /  <a href=/categories/> 分类 </a>  /  <a href=/tags/> 标签 </a>  /  <a href=/search/> 搜索 </a>  /  <div><input id=theme-toggle style=display:none type=checkbox><label for=theme-toggle id=theme-toggle-label><svg class=icons id=theme-icon><use href=https://nnnewb.github.io/icons.svg#lightMode></use></svg></label><audio id=theme-sound><source src=https://nnnewb.github.io/click.ogg type=audio/ogg></audio></div></nav></header><main><h1>DVWA上手记录-反射型XSS</h1><p class=author-line>作于：2022-04-28 16:29 ，预计阅读时间 3 分钟<article><h2 id=qian-yan>前言</h2><p>比较简单，快速过。<h2 id=yuan-li>原理</h2><p>服务端把用户提交的内容没有做好过滤就渲染到了网页上。只有后端渲染才存在这个问题，前后端分离前端渲染的情况都是 DOM XSS。<h2 id=jie-ti>解题</h2><h3 id=shou-ji-xin-xi>收集信息</h3><p><img alt=image-20220428154827171 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-10/image-20220428154827171.webp><p><img alt=image-20220428154836075 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-10/image-20220428154836075.webp><p>尝试注入一个<code>&lt;b>mike&lt;/b></code>。<p><img alt=image-20220428154922489 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-10/image-20220428154922489.webp><p>好，直接开干。<h3 id=lownan-du>Low难度</h3><p>直接插一个 <code>script</code> 就完了。<code>&lt;script>alert(1)&lt;/script></code><p><img alt=image-20220428155023932 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-10/image-20220428155023932.webp><h3 id=mediumnan-du>Medium难度</h3><p>尝试<code>&lt;b>mike&lt;/b></code>没有过滤，再试<code>&lt;img src="" onerror="alert(1)"/></code><p><img alt=image-20220428155154196 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-10/image-20220428155154196.webp><p>已经成功了，再看下代码。<pre class=language-php data-lang=php style=color:#fdf4c1aa;background-color:#282828><code class=language-php data-lang=php><span>&lt;?php
</span><span style=color:#fdf4c1>
</span><span style=color:#fabd2f>header </span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"X-XSS-Protection: 0"</span><span style=color:#fdf4c1>);
</span><span style=color:#fdf4c1>
</span><span style=color:#928374;font-style:italic>// Is there any input?
</span><span style=color:#fa5c4b>if</span><span style=color:#fdf4c1>( </span><span style=color:#fabd2f>array_key_exists</span><span style=color:#fdf4c1>( </span><span style=color:#b8bb26>"name"</span><span style=color:#fdf4c1>, $_GET ) </span><span style=color:#fe8019>&& </span><span style=color:#fdf4c1>$_GET[ </span><span style=color:#b8bb26>'name' </span><span style=color:#fdf4c1>] </span><span style=color:#fe8019>!= </span><span style=color:#d3869b>NULL </span><span style=color:#fdf4c1>) {
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Get input
</span><span style=color:#fdf4c1>    $name </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>str_replace</span><span style=color:#fdf4c1>( </span><span style=color:#b8bb26>'&lt;script>'</span><span style=color:#fdf4c1>, </span><span style=color:#b8bb26>''</span><span style=color:#fdf4c1>, $_GET[ </span><span style=color:#b8bb26>'name' </span><span style=color:#fdf4c1>] );
</span><span style=color:#fdf4c1>
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Feedback for end user
</span><span style=color:#fdf4c1>    </span><span style=color:#fabd2f>echo </span><span style=color:#b8bb26>"&lt;pre>Hello </span><span style=color:#fdf4c1>${name}</span><span style=color:#b8bb26>&lt;/pre>"</span><span style=color:#fdf4c1>;
</span><span style=color:#fdf4c1>}
</span><span style=color:#fdf4c1>
</span><span>?>
</span></code></pre><p>这个情况bypass的方法很多，大小写或者加个空格、多插一个<code>&lt;script></code>让服务端替换，都可以。<h3 id=highnan-du>High难度</h3><p>试了下<code>&lt;b>mike&lt;/b></code>依然过了，再试一次<code>&lt;img src="" onerror="alert(1)"/></code>。<p><img alt=image-20220428155519720 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-10/image-20220428155519720.webp><p>又直接过了，行吧...感觉有点无聊了。再看下代码里怎么防的。<pre class=language-php data-lang=php style=color:#fdf4c1aa;background-color:#282828><code class=language-php data-lang=php><span>&lt;?php
</span><span style=color:#fdf4c1>
</span><span style=color:#fabd2f>header </span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"X-XSS-Protection: 0"</span><span style=color:#fdf4c1>);
</span><span style=color:#fdf4c1>
</span><span style=color:#928374;font-style:italic>// Is there any input?
</span><span style=color:#fa5c4b>if</span><span style=color:#fdf4c1>( </span><span style=color:#fabd2f>array_key_exists</span><span style=color:#fdf4c1>( </span><span style=color:#b8bb26>"name"</span><span style=color:#fdf4c1>, $_GET ) </span><span style=color:#fe8019>&& </span><span style=color:#fdf4c1>$_GET[ </span><span style=color:#b8bb26>'name' </span><span style=color:#fdf4c1>] </span><span style=color:#fe8019>!= </span><span style=color:#d3869b>NULL </span><span style=color:#fdf4c1>) {
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Get input
</span><span style=color:#fdf4c1>    $name </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>preg_replace</span><span style=color:#fdf4c1>( </span><span style=color:#b8bb26>'/&lt;(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)s(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)c(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)r(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)i(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)p(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)t/i'</span><span style=color:#fdf4c1>, </span><span style=color:#b8bb26>''</span><span style=color:#fdf4c1>, $_GET[ </span><span style=color:#b8bb26>'name' </span><span style=color:#fdf4c1>] );
</span><span style=color:#fdf4c1>
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Feedback for end user
</span><span style=color:#fdf4c1>    </span><span style=color:#fabd2f>echo </span><span style=color:#b8bb26>"&lt;pre>Hello </span><span style=color:#fdf4c1>${name}</span><span style=color:#b8bb26>&lt;/pre>"</span><span style=color:#fdf4c1>;
</span><span style=color:#fdf4c1>}
</span><span style=color:#fdf4c1>
</span><span>?>
</span></code></pre><p>这正则就有点离谱了=。= 如何构造一个能被这个正则替换过之后还有效的东西呢。然后就想到了转义。<p><code>&lt;&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74>alert(1)&lt;/&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74></code><p>但是不行。想了想没有什么太好的办法，毕竟只要顺序出现<code>&lt;script</code>这些字符就会被淦，而且是整个被淦，在tag中间加tag的办法也行不通。最后想想还是对啊，干嘛非揪着 <code>script</code> 不放。不用<code>&lt;script</code>还是有大把的 payload 可以用。<p>想想这个过滤还是挺离谱的，目前见过的XSS过滤方法基本都是替换掉了 <code>&lt;>()</code> 这些字符，反正构造不出函数调用和HTML标签。<h2 id=zong-jie>总结</h2><p>找个更好玩的 XSS 靶场的念头开始增强了。不过多少还有点担心 XSS 漏洞未来会不会退出主流（好像现在就有点退出主流的意思了），学了能不能涨点身价什么的...想太多。<p>没有特别好总结的，利用<code>script</code>或者别的标签执行 js 就完了。</article><p class=tags-data><a href=/tags/security>/security/</a> <a href=/tags/dvwa>/dvwa/</a> <a href=/tags/xss>/xss/</a></p><script data-repo-id="MDEwOlJlcG9zaXRvcnkzOTg0ODYyMTg=" async crossorigin data-category=Announcements data-category-id=DIC_kwDOF8Bqys4Cegmn data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-mapping=pathname data-reactions-enabled=1 data-repo=nnnewb/nnnewb.github.io data-strict=0 data-theme=noborder_light id=giscus_script src=https://giscus.app/client.js></script></main><footer><hr><div id=footer-container><div><p style=text-align:center>Copyright © 2018-2024 weakptr <a href=mailto:weak_ptr@outlook.com>&lt;weak_ptr@outlook.com></a><p style=text-align:center>Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme, <a rel="noopener noreferrer" href=https://speyll.github.io/suCSS/ target=_blank>suCSS</a> framework & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a>, modified by <a rel="noopener noreferrer" href=https://github.com/nnnewb/ target=_blank>nnnewb</a>.<p style=text-align:center>Theme and color theme licensed under <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a>.</div></div></footer>