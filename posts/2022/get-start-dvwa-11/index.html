<!doctype html><html lang=zh><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>DVWA上手记录-存储型XSS</title><meta content=DVWA上手记录-存储型XSS name=title><meta content=一点点从这个世界上消失。 name=description><meta content=website property=og:type><meta content=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/ property=og:url><meta content="weakptr's blog" property=og:site_name><meta content=DVWA上手记录-存储型XSS property=og:title><meta content=一点点从这个世界上消失。 property=og:description><meta content=https://nnnewb.github.io/image/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/ property=twitter:url><meta content=DVWA上手记录-存储型XSS property=twitter:title><meta content=一点点从这个世界上消失。 property=twitter:description><meta content=https://nnnewb.github.io/image/favicon.ico property=twitter:image><link href=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/ rel=canonical><link rel="shortcut icon" href=https://nnnewb.github.io/image/favicon.ico type=image/x-icon><link href=https://nnnewb.github.io/css/reset.css rel=stylesheet><link href=https://nnnewb.github.io/css/pallete.css rel=stylesheet><link href=https://nnnewb.github.io/css/suCSS.css rel=stylesheet><link href=https://nnnewb.github.io/archive.css rel=stylesheet><link href=https://nnnewb.github.io/style.css rel=stylesheet><script defer src=https://nnnewb.github.io/js/script.js></script><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y rel=stylesheet><script crossorigin defer integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js></script><script crossorigin defer integrity=sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js></script><script crossorigin defer integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            // customised options
            // • auto-render specific keys, e.g.:
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: false }
            ],
            // • rendering keys, e.g.:
            throwOnError: true
        });
    });</script><script src=https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js></script><script>document.addEventListener('DOMContentLoaded', function () {
        // 查找所有具有 'pre' 标签且类名为 'language-mermaid' 的元素
        const mermaidElements = document.getElementsByClassName('language-mermaid');
        for (let i = 0; i < mermaidElements.length; i++) {
            const el = mermaidElements.item(i);
            if (el.tagName === "PRE" && !el.classList.contains('mermaid')) {
                el.innerHTML = el.textContent;
                el.classList.add('mermaid');
            }
        }

        mermaid.initialize({ startOnLoad: true, theme: 'dark', });
    })</script><script>if (window.location.hostname.toLowerCase() !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?dbb9df33a2de52aede8bccd84a7493ad";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    }</script><link href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Medium/result.css rel=stylesheet><link href=https://chinese-fonts-cdn.deno.dev/packages/maple-mono-cn/dist/MapleMono-CN-Regular/result.css rel=stylesheet><body><header><nav id=nav-bar><a href=/> 首页 </a>  /  <a href=/posts/> 文章 </a>  /  <a href=/categories/> 分类 </a>  /  <a href=/tags/> 标签 </a>  /  <a href=/search/> 搜索 </a>  /  <div><input id=theme-toggle style=display:none type=checkbox><label for=theme-toggle id=theme-toggle-label><svg class=icons id=theme-icon><use href=https://nnnewb.github.io/icons.svg#lightMode></use></svg></label><audio id=theme-sound><source src=https://nnnewb.github.io/click.ogg type=audio/ogg></audio></div></nav></header><main><h1>DVWA上手记录-存储型XSS</h1><p class=author-line>作于：2022-04-28 17:21 ，预计阅读时间 4 分钟<article><h2 id=qian-yan>前言</h2><p>还是很简单。<h2 id=yuan-li>原理</h2><p>没过滤就保存到了数据库里，渲染的时候也没做好过滤。<h2 id=jie-ti>解题</h2><h3 id=shou-ji-xin-xi>收集信息</h3><p><img alt=image-20220428163441737 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/image-20220428163441737.webp><p>留言板，而且试了下没过滤 <code>&lt;b></code>，所以基本和反射型没什么区别，大概。<h3 id=lownan-du>Low难度</h3><p>直接插入一个<code>&lt;script>alert(1)&lt;/script></code>。<p><img alt=image-20220428163539665 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/image-20220428163539665.webp><h3 id=mediumnan-du>Medium难度</h3><p>重置下数据库，再试试直接注入<code>&lt;script>alert(1)&lt;/script></code>。<p><img alt=image-20220428163928089 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/image-20220428163928089.webp><p>发现标签没了。看下源码。<pre class=language-php data-lang=php style=color:#fdf4c1aa;background-color:#282828><code class=language-php data-lang=php><span>&lt;?php
</span><span style=color:#fdf4c1>
</span><span style=color:#fa5c4b>if</span><span style=color:#fdf4c1>( </span><span style=color:#fabd2f>isset</span><span style=color:#fdf4c1>( $_POST[ </span><span style=color:#b8bb26>'btnSign' </span><span style=color:#fdf4c1>] ) ) {
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Get input
</span><span style=color:#fdf4c1>    $message </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>trim</span><span style=color:#fdf4c1>( $_POST[ </span><span style=color:#b8bb26>'mtxMessage' </span><span style=color:#fdf4c1>] );
</span><span style=color:#fdf4c1>    $name    </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>trim</span><span style=color:#fdf4c1>( $_POST[ </span><span style=color:#b8bb26>'txtName' </span><span style=color:#fdf4c1>] );
</span><span style=color:#fdf4c1>
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Sanitize message input
</span><span style=color:#fdf4c1>    $message </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>strip_tags</span><span style=color:#fdf4c1>( </span><span style=color:#fabd2f>addslashes</span><span style=color:#fdf4c1>( $message ) );
</span><span style=color:#fdf4c1>    $message </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>((</span><span style=color:#fabd2f>isset</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>]) </span><span style=color:#fe8019>&& </span><span style=color:#fabd2f>is_object</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>])) ? </span><span style=color:#fabd2f>mysqli_real_escape_string</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>],  $message ) : ((</span><span style=color:#fabd2f>trigger_error</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span><span style=color:#fdf4c1>, </span><span style=color:#fabd2f>E_USER_ERROR</span><span style=color:#fdf4c1>)) ? </span><span style=color:#b8bb26>""</span><span style=color:#fdf4c1> : </span><span style=color:#b8bb26>""</span><span style=color:#fdf4c1>));
</span><span style=color:#fdf4c1>    $message </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>htmlspecialchars</span><span style=color:#fdf4c1>( $message );
</span><span style=color:#fdf4c1>
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Sanitize name input
</span><span style=color:#fdf4c1>    $name </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>str_replace</span><span style=color:#fdf4c1>( </span><span style=color:#b8bb26>'&lt;script>'</span><span style=color:#fdf4c1>, </span><span style=color:#b8bb26>''</span><span style=color:#fdf4c1>, $name );
</span><span style=color:#fdf4c1>    $name </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>((</span><span style=color:#fabd2f>isset</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>]) </span><span style=color:#fe8019>&& </span><span style=color:#fabd2f>is_object</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>])) ? </span><span style=color:#fabd2f>mysqli_real_escape_string</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>],  $name ) : ((</span><span style=color:#fabd2f>trigger_error</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span><span style=color:#fdf4c1>, </span><span style=color:#fabd2f>E_USER_ERROR</span><span style=color:#fdf4c1>)) ? </span><span style=color:#b8bb26>""</span><span style=color:#fdf4c1> : </span><span style=color:#b8bb26>""</span><span style=color:#fdf4c1>));
</span><span style=color:#fdf4c1>
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Update database
</span><span style=color:#fdf4c1>    $query  </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>"</span><span style=color:#fa5c4b>INSERT INTO</span><span style=color:#b8bb26> guestbook ( comment, name ) </span><span style=color:#fa5c4b>VALUES</span><span style=color:#b8bb26> ( '</span><span style=color:#fdf4c1>$message</span><span style=color:#b8bb26>', '</span><span style=color:#fdf4c1>$name</span><span style=color:#b8bb26>' );"</span><span style=color:#fdf4c1>;
</span><span style=color:#fdf4c1>    $result </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>mysqli_query</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>],  $query ) </span><span style=color:#fe8019>or </span><span style=color:#fa5c4b>die</span><span style=color:#fdf4c1>( </span><span style=color:#b8bb26>'&lt;pre>' </span><span style=color:#fe8019>. </span><span style=color:#fdf4c1>((</span><span style=color:#fabd2f>is_object</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>])) ? </span><span style=color:#fabd2f>mysqli_error</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>]) : (($___mysqli_res </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>mysqli_connect_error</span><span style=color:#fdf4c1>()) ? $___mysqli_res : </span><span style=color:#d3869b>false</span><span style=color:#fdf4c1>)) </span><span style=color:#fe8019>. </span><span style=color:#b8bb26>'&lt;/pre>' </span><span style=color:#fdf4c1>);
</span><span style=color:#fdf4c1>
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>//mysql_close();
</span><span style=color:#fdf4c1>}
</span><span style=color:#fdf4c1>
</span><span>?>
</span></code></pre><p>注意<code>sanitize message input</code>和<code>sanitize name input</code>，使用了两种不同的方法替换掉<code>script</code>标签。一个是<code>strip_tags</code>一个是<code>str_replace</code>。显然<code>str_replace</code>是更弱的方法，我们先过掉<code>str_replace</code>。payload 只需要改一下大小写：<code>&lt;sCript>alert(1)&lt;/sCript></code>。<p><img alt=image-20220428164406647 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/image-20220428164406647.webp><p>但是尴尬地发现这个 <code>input</code> 标签限制了长度，直接改 HTML 解决。<p><img alt=image-20220428164457027 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/image-20220428164457027.webp><p><img alt=image-20220428164501682 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/image-20220428164501682.webp><p>好的，成功过了一个。重置数据库后再尝试 bypass 掉 <code>strip_tags</code>。<p>函数文档提到：<blockquote><p>Self-closing XHTML tags are ignored and only non-self-closing tags should be used in <code>allowed_tags</code>.</blockquote><p>而且<blockquote><p><strong>Warning</strong><p>This function should not be used to try to prevent XSS attacks. Use more appropriate functions like <a href=https://www.php.net/manual/en/function.htmlspecialchars.php>htmlspecialchars()</a> or other means depending on the context of the output.</blockquote><p>所以可以肯定 <code>strip_tags</code> 是挡不住 XSS 的。文档提到会忽略 <code>self-closing XHTML tags</code>，所以用 <code>img</code> 标签试一下。payload改成：<code>&lt;img src="" onerror=alert(1)/></code><p><img alt=image-20220428164835457 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/image-20220428164835457.webp><p>失败。直接谷歌一下怎么 bypass <code>strip_tags</code>。<a href=https://stackoverflow.com/questions/5788527/is-strip-tags-vulnerable-to-scripting-attacks>这个链接</a>解释了<code>strip_tags</code>的实现为什么不能防御 XSS ，另一个回答提供了一个 payload：<code>&lt;&lt;a>script>alert(XSS);&lt;&lt;/a>/script></code>。直接试一试。<p><img alt=image-20220428165138291 src=https://nnnewb.github.io/posts/2022/get-start-dvwa-11/image-20220428165138291.webp><p>好的，证明并不靠谱。注意到php代码里还做了<code>addslashes</code>，保护比较好了，干脆放弃。继续做 High 难度。<h3 id=highnan-du>High难度</h3><p>看代码。<pre class=language-php data-lang=php style=color:#fdf4c1aa;background-color:#282828><code class=language-php data-lang=php><span>&lt;?php
</span><span style=color:#fdf4c1>
</span><span style=color:#fa5c4b>if</span><span style=color:#fdf4c1>( </span><span style=color:#fabd2f>isset</span><span style=color:#fdf4c1>( $_POST[ </span><span style=color:#b8bb26>'btnSign' </span><span style=color:#fdf4c1>] ) ) {
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Get input
</span><span style=color:#fdf4c1>    $message </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>trim</span><span style=color:#fdf4c1>( $_POST[ </span><span style=color:#b8bb26>'mtxMessage' </span><span style=color:#fdf4c1>] );
</span><span style=color:#fdf4c1>    $name    </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>trim</span><span style=color:#fdf4c1>( $_POST[ </span><span style=color:#b8bb26>'txtName' </span><span style=color:#fdf4c1>] );
</span><span style=color:#fdf4c1>
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Sanitize message input
</span><span style=color:#fdf4c1>    $message </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>strip_tags</span><span style=color:#fdf4c1>( </span><span style=color:#fabd2f>addslashes</span><span style=color:#fdf4c1>( $message ) );
</span><span style=color:#fdf4c1>    $message </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>((</span><span style=color:#fabd2f>isset</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>]) </span><span style=color:#fe8019>&& </span><span style=color:#fabd2f>is_object</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>])) ? </span><span style=color:#fabd2f>mysqli_real_escape_string</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>],  $message ) : ((</span><span style=color:#fabd2f>trigger_error</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span><span style=color:#fdf4c1>, </span><span style=color:#fabd2f>E_USER_ERROR</span><span style=color:#fdf4c1>)) ? </span><span style=color:#b8bb26>""</span><span style=color:#fdf4c1> : </span><span style=color:#b8bb26>""</span><span style=color:#fdf4c1>));
</span><span style=color:#fdf4c1>    $message </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>htmlspecialchars</span><span style=color:#fdf4c1>( $message );
</span><span style=color:#fdf4c1>
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Sanitize name input
</span><span style=color:#fdf4c1>    $name </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>preg_replace</span><span style=color:#fdf4c1>( </span><span style=color:#b8bb26>'/&lt;(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)s(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)c(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)r(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)i(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)p(</span><span style=color:#d3869b>.</span><span style=color:#fe8019>*</span><span style=color:#b8bb26>)t/i'</span><span style=color:#fdf4c1>, </span><span style=color:#b8bb26>''</span><span style=color:#fdf4c1>, $name );
</span><span style=color:#fdf4c1>    $name </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>((</span><span style=color:#fabd2f>isset</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>]) </span><span style=color:#fe8019>&& </span><span style=color:#fabd2f>is_object</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>])) ? </span><span style=color:#fabd2f>mysqli_real_escape_string</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>],  $name ) : ((</span><span style=color:#fabd2f>trigger_error</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span><span style=color:#fdf4c1>, </span><span style=color:#fabd2f>E_USER_ERROR</span><span style=color:#fdf4c1>)) ? </span><span style=color:#b8bb26>""</span><span style=color:#fdf4c1> : </span><span style=color:#b8bb26>""</span><span style=color:#fdf4c1>));
</span><span style=color:#fdf4c1>
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>// Update database
</span><span style=color:#fdf4c1>    $query  </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>"</span><span style=color:#fa5c4b>INSERT INTO</span><span style=color:#b8bb26> guestbook ( comment, name ) </span><span style=color:#fa5c4b>VALUES</span><span style=color:#b8bb26> ( '</span><span style=color:#fdf4c1>$message</span><span style=color:#b8bb26>', '</span><span style=color:#fdf4c1>$name</span><span style=color:#b8bb26>' );"</span><span style=color:#fdf4c1>;
</span><span style=color:#fdf4c1>    $result </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>mysqli_query</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>],  $query ) </span><span style=color:#fe8019>or </span><span style=color:#fa5c4b>die</span><span style=color:#fdf4c1>( </span><span style=color:#b8bb26>'&lt;pre>' </span><span style=color:#fe8019>. </span><span style=color:#fdf4c1>((</span><span style=color:#fabd2f>is_object</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>])) ? </span><span style=color:#fabd2f>mysqli_error</span><span style=color:#fdf4c1>($GLOBALS[</span><span style=color:#b8bb26>"___mysqli_ston"</span><span style=color:#fdf4c1>]) : (($___mysqli_res </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>mysqli_connect_error</span><span style=color:#fdf4c1>()) ? $___mysqli_res : </span><span style=color:#d3869b>false</span><span style=color:#fdf4c1>)) </span><span style=color:#fe8019>. </span><span style=color:#b8bb26>'&lt;/pre>' </span><span style=color:#fdf4c1>);
</span><span style=color:#fdf4c1>
</span><span style=color:#fdf4c1>    </span><span style=color:#928374;font-style:italic>//mysql_close();
</span><span style=color:#fdf4c1>}
</span><span style=color:#fdf4c1>
</span><span>?>
</span></code></pre><p>老样子，直接用<code>img</code>的payload就可以过，不多写了。<h3 id=strip-tags>strip_tags</h3><p>现在回头研究下 <code>strip_tags</code> 这个函数要怎么 bypass 。首先链接里的问题是11年前提出（大约是2011年）的，提问时的PHP版本是 5.3（见提问者给的链接），所以在 5.x 版本可能 <code>strip_tags</code> 确实会被 <code>&lt;&lt;a>script>alert(XSS);&lt;&lt;/a>/script></code> 给绕过。但我的DVWA配的环境是 PHP 7 + MySQL 5.7，所以这个问答里给出的 payload 可能是 PHP 7 已经修复了故而没用。<p>从 Teh playground 测试的结果看新实现可能是栈方式了，就是<code>&lt;</code>计数+1，后面的全都删掉。因为<code>&lt;</code>一定被x，最多只能留下<code>></code>，想在 <code>strip_tags</code> 里留下标签大概是做不到了。<p>看下帮助手册，也是提到用<code>name</code>字段而不是<code>message</code>字段。现在是没辙了。<h2 id=zong-jie>总结</h2><p>最大的困难是<code>strip_tags</code>，这要放比赛里我就是个寄吧。<p>好了不说自己了。XSS三个板块感觉没有多少变化，一个<code>img</code>的payload就能通杀，感觉有点鸡了，缺乏实感，游戏体验略差。<p>暂时就这样吧。</article><p class=tags-data><a href=/tags/security>/security/</a> <a href=/tags/dvwa>/dvwa/</a> <a href=/tags/xss>/xss/</a></p><script data-repo-id="MDEwOlJlcG9zaXRvcnkzOTg0ODYyMTg=" async crossorigin data-category=Announcements data-category-id=DIC_kwDOF8Bqys4Cegmn data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-mapping=pathname data-reactions-enabled=1 data-repo=nnnewb/nnnewb.github.io data-strict=0 data-theme=noborder_light id=giscus_script src=https://giscus.app/client.js></script></main><footer><hr><div id=footer-container><div><p style=text-align:center>Copyright © 2018-2024 weakptr <a href=mailto:weak_ptr@outlook.com>&lt;weak_ptr@outlook.com></a><p style=text-align:center>Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme, <a rel="noopener noreferrer" href=https://speyll.github.io/suCSS/ target=_blank>suCSS</a> framework & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a>, modified by <a rel="noopener noreferrer" href=https://github.com/nnnewb/ target=_blank>nnnewb</a>.<p style=text-align:center>Theme and color theme licensed under <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a>.</div></div></footer>