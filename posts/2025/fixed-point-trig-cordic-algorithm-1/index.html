<!doctype html><html lang=zh><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>定点数三角函数：CORDIC 算法（1）</title><meta content="定点数三角函数：CORDIC 算法（1）" name=title><meta content=一点点从这个世界上消失。 name=description><meta content=website property=og:type><meta content=https://nnnewb.github.io/posts/2025/fixed-point-trig-cordic-algorithm-1/ property=og:url><meta content="weakptr's blog" property=og:site_name><meta content="定点数三角函数：CORDIC 算法（1）" property=og:title><meta content=一点点从这个世界上消失。 property=og:description><meta content=https://nnnewb.github.io/image/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://nnnewb.github.io/posts/2025/fixed-point-trig-cordic-algorithm-1/ property=twitter:url><meta content="定点数三角函数：CORDIC 算法（1）" property=twitter:title><meta content=一点点从这个世界上消失。 property=twitter:description><meta content=https://nnnewb.github.io/image/favicon.ico property=twitter:image><link href=https://nnnewb.github.io/posts/2025/fixed-point-trig-cordic-algorithm-1/ rel=canonical><link rel="shortcut icon" href=https://nnnewb.github.io/image/favicon.ico type=image/x-icon><link href=https://nnnewb.github.io/css/reset.css rel=stylesheet><link href=https://nnnewb.github.io/css/pallete.css rel=stylesheet><link href=https://nnnewb.github.io/css/suCSS.css rel=stylesheet><link href=https://nnnewb.github.io/archive.css rel=stylesheet><link href=https://nnnewb.github.io/style.css rel=stylesheet><script defer src=https://nnnewb.github.io/js/script.js></script><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y rel=stylesheet><script crossorigin defer integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js></script><script crossorigin defer integrity=sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js></script><script crossorigin defer integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            // customised options
            // • auto-render specific keys, e.g.:
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: false }
            ],
            // • rendering keys, e.g.:
            throwOnError: true
        });
    });</script><script src=https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js></script><script>document.addEventListener('DOMContentLoaded', function () {
        // 查找所有具有 'pre' 标签且类名为 'language-mermaid' 的元素
        const mermaidElements = document.getElementsByClassName('language-mermaid');
        for (let i = 0; i < mermaidElements.length; i++) {
            const el = mermaidElements.item(i);
            if (el.tagName === "PRE" && !el.classList.contains('mermaid')) {
                el.innerHTML = el.textContent;
                el.classList.add('mermaid');
            }
        }

        mermaid.initialize({ startOnLoad: true, theme: 'dark', });
    })</script><script>if (window.location.hostname.toLowerCase() !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?dbb9df33a2de52aede8bccd84a7493ad";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    }</script><link href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Medium/result.css rel=stylesheet><link href=https://chinese-fonts-cdn.deno.dev/packages/maple-mono-cn/dist/MapleMono-CN-Regular/result.css rel=stylesheet><body><header><nav id=nav-bar><a href=/> 首页 </a>  /  <a href=/posts/> 文章 </a>  /  <a href=/categories/> 分类 </a>  /  <a href=/tags/> 标签 </a>  /  <a href=/search/> 搜索 </a>  /  <div><input id=theme-toggle style=display:none type=checkbox><label for=theme-toggle id=theme-toggle-label><svg class=icons id=theme-icon><use href=https://nnnewb.github.io/icons.svg#lightMode></use></svg></label><audio id=theme-sound><source src=https://nnnewb.github.io/click.ogg type=audio/ogg></audio></div></nav></header><main><h1>定点数三角函数：CORDIC 算法（1）</h1><p class=author-line>作于：2025-08-21 15:28 ，预计阅读时间 6 分钟<article><h2 id=qian-yan>前言</h2><p>CORDIC 算法比我想的还要难一点，也分多篇来写。<h2 id=cordic-suan-fa>CORDIC 算法</h2><h3 id=ji-ben-si-xiang>基本思想</h3><p>CORDIC 算法的基本原理是旋转向量逼近待求角 $\theta$ ，再根据直角三角形上三角函数的定义，将向量分量作为 sin/cos 值返回。<h3 id=xiang-liang-xuan-zhuan>向量旋转</h3><p>将平面上的向量 $\vec{V}=(x,y)$ 旋转 $\theta$ 角，公式为<p>$$ \vec{V_r} = \begin{cases} x_r = x \cdot \cos\theta - y \cdot \sin\theta \\ y_r = y \cdot \cos\theta + x \cdot \sin\theta \end{cases} $$<p>将 $\cos\theta$ 提取公因式，由于 $\tan\theta = \frac{\sin\theta}{\cos\theta}$，得到<p>$$ \vec{V_r} = \begin{cases} x_r = \cos\theta (x - y \cdot \tan\theta) \\ y_r = \cos\theta (y + x \cdot \tan\theta) \end{cases} $$<h3 id=die-dai-bi-jin>迭代逼近</h3><p>CORDIC 是一种迭代逼近算法，它将原始的 $\theta$ 角拆分成 $N$ 次旋转操作，每次旋转一个细微角度来逼近：$\theta = \sum\limits_{i=0}^{N-1}{d_i \cdot a_i}$<blockquote><p>$d_i \cdot a_i$ 表示的是第 $i$ 次旋转的弧度值，$d_i$ 是旋转方向，正为逆时针，负为顺时针。</blockquote><p>我们就可以写出迭代公式：<p>$$ \vec{V_{i+1}} = \begin{cases} x_{i+1} = \cos(d_i \cdot a_i) (x_i - y_i \cdot \tan(d_i \cdot a_i)) \\ y_{i+1} = \cos(d_i \cdot a_i) (y_i + x_i \cdot \tan(d_i \cdot a_i)) \end{cases} $$<p>又因为 $d_i$ 实际上取值只有正负号，$\tan$ 是奇函数，$\tan(-x)=-\tan(x)$，化简得到<p>$$ \vec{V_{i+1}} = \begin{cases} x_{i+1} = \cos(d_i \cdot a_i) (x_i - y_i \cdot d_i \cdot \tan(a_i)) \\ y_{i+1} = \cos(d_i \cdot a_i) (y_i + x_i \cdot d_i \cdot \tan(a_i)) \end{cases} $$<p>我们再考虑：$\cos(d_i \cdot a_i)$<p>因为 $\cos$ 是偶函数，关于 y 轴对称，正负号不影响取值。因此，我们可以从 $\cos$ 里移除 $d_i$ 系数。<p>$$ \vec{V_{i+1}} = \begin{cases} x_{i+1} = \cos(a_i) (x_i - y_i \cdot d_i \cdot \tan(a_i)) \\ y_{i+1} = \cos(a_i) (y_i + x_i \cdot d_i \cdot \tan(a_i)) \end{cases} $$<h3 id=xuan-ze-te-shu-hu-du-zhi>选择特殊弧度值</h3><p>在每一轮迭代中，选择特殊的旋转弧度，让 $\tan(a_i)$ 的取值为 $2^{-i}$ ，也就是设 $a_i = \arctan(2^{-i})$<p>从而让迭代公式变为<p>$$ \vec{V_{i+1}} = \begin{cases} x_{i+1} = \cos(a_i) \cdot (x_i - y_i \cdot d_i \cdot 2^{-i}) \\ y_{i+1} = \cos(a_i) \cdot (y_i + x_i \cdot d_i \cdot 2^{-i}) \end{cases} $$<h3 id=ti-qu-cos-ai-xi-shu>提取 cos(ai) 系数</h3><p>我们以计算 $x_{i+2}$ 为例，观察展开过程：<p>$$ \begin{aligned} x_{i+2} &= \cos(a_{i+1}) \cdot (x_{i+1} - y_{i+1} \cdot d_{i+1} \cdot 2^{-i+1}) \\ &= \cos(a_{i+1}) \cdot [ \cos(a_i) \cdot (x_i - y_i \cdot d_i \cdot 2^{-i}) - \cos(a_i) \cdot (y_i + x_i \cdot d_i \cdot 2^{-i}) \cdot d_{i+1} \cdot 2^{-i+1} ] \\ &= \cos(a_{i+1}) \cdot \cos(a_i) \cdot [ (x_i - y_i \cdot d_i \cdot 2^{-i}) - (y_i + x_i \cdot d_i \cdot 2^{-i}) \cdot d_{i+1} \cdot 2^{-i+1} ] \\ \end{aligned} $$<p>每次展开就会多一个 $\cos(a_i)$，右边括号里则多一个加减法和位移操作。<p>从 $x_i,y_i$ 的定义里不难发现发现，每个分量都会展开得到一个 $\cos(a)$ 的因子。<p>所以进一步展开，我们依然可以得到新的公因式。<blockquote><p>此处可以用矩阵乘法的方式更形式化地证明可以提取出 $\prod^{N-1}_{i=0}\cos(a_i)$ 。<p>还是问 AI 要证明过程吧。</blockquote><p>我们可以看到 $cos(a_i)$ 这个公因式是可以被提取出来，迭代 $N$ 轮就是叠乘 $N$ 次，记为：<p>$$ \begin{aligned} K &= \cos(a_0) \cdot \cos(a_1) \cdot \cos(a_2) \cdot ... \cdot \cos(a_i) \\ &= \prod_{i=0}^{N-1}\cos(a_i) \end{aligned} $$<p>所以 $\cos(a_i)$ 我们都可以提取到迭代最后进行计算，N轮迭代得到：<p>$$ \vec{V_{r}} = \begin{cases} x_{r} = K \cdot x_N \\ y_{r} = K \cdot y_N \end{cases} $$<p>其中 $x_N, y_N$ 都是没有 $\cos(a_i)$ 系数的迭代结果，提取公因式后的新的迭代公式为：<p>$$ \begin{cases} x_{i+1} = x_i - y_i \cdot d_i \cdot 2^{-i} \\ y_{i+1} = y_i + x_i \cdot d_i \cdot 2^{-i} \end{cases} $$<h3 id=qiu-xi-shu-k>求系数 K</h3><p>因为我们预设了 $2^{-i}=\tan(a_i)$ ，已知 $a_i = \arctan(2^{-i})$，代入可得：<p>$$ \begin{aligned} K &= \prod_{i=0}^{N-1} \cos(a_i) \\ &= \prod_{i=0}^{N-1} \cos(\arctan(2^{-i})) \end{aligned} $$<p>程序中我们一般迭代的是一个固定次数 $N$，可以预先求出 $K$ 的值。<blockquote><p>实际上，当 $N=\infty$ 时，K 会收敛到一个极限值。具体的证明过程可以问 AI 。<p>所以我们其实也可以将 $K$ 直接取这个极限值，无论迭代多少次都乘这个固定系数。</blockquote><p>我们使用 Python 计算 $K$ 的近似数值解：<pre class=language-python data-lang=python style=color:#fdf4c1aa;background-color:#282828><code class=language-python data-lang=python><span style=color:#fa5c4b>import </span><span>math
</span><span>
</span><span style=color:#fa5c4b>def </span><span style=color:#8ec07c>calculate_K</span><span>(</span><span style=color:#fdf4c1>N</span><span>):
</span><span>    K </span><span style=color:#fe8019>= </span><span style=color:#d3869b>1.0  </span><span style=color:#928374;font-style:italic># 初始化 K 为 1.0，因为是乘积
</span><span>    </span><span style=color:#fa5c4b>for </span><span>i </span><span style=color:#fa5c4b>in </span><span style=color:#fabd2f>range</span><span style=color:#fdf4c1>(N)</span><span>:  </span><span style=color:#928374;font-style:italic># 循环从 0 到 N (不包括 N)
</span><span>        term </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>math.cos(math.atan(</span><span style=color:#d3869b>2</span><span style=color:#fe8019>**</span><span style=color:#fdf4c1>(</span><span style=color:#fe8019>-</span><span style=color:#fdf4c1>i)))
</span><span>        K </span><span style=color:#fe8019>*= </span><span>term
</span><span>    </span><span style=color:#fa5c4b>return </span><span>K
</span><span>
</span><span>N_value </span><span style=color:#fe8019>= </span><span style=color:#d3869b>5
</span><span>result_K </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>calculate_K(N_value)
</span><span style=color:#fabd2f>print</span><span style=color:#fdf4c1>(</span><span style=color:#fa5c4b>f</span><span style=color:#b8bb26>"当 N = </span><span style=color:#fdf4c1>{N_value}</span><span style=color:#b8bb26> 时，K 的值为: </span><span style=color:#fdf4c1>{result_K:.09f}</span><span style=color:#b8bb26>"</span><span style=color:#fdf4c1>)
</span><span>
</span><span>N_value_large </span><span style=color:#fe8019>= </span><span style=color:#d3869b>10
</span><span>result_K_large </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>calculate_K(N_value_large)
</span><span style=color:#fabd2f>print</span><span style=color:#fdf4c1>(</span><span style=color:#fa5c4b>f</span><span style=color:#b8bb26>"当 N = </span><span style=color:#fdf4c1>{N_value_large}</span><span style=color:#b8bb26> 时，K 的值为: </span><span style=color:#fdf4c1>{result_K_large:.09f}</span><span style=color:#b8bb26>"</span><span style=color:#fdf4c1>)
</span><span>
</span><span>N_value_large </span><span style=color:#fe8019>= </span><span style=color:#d3869b>30
</span><span>result_K_large </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>calculate_K(N_value_large)
</span><span style=color:#fabd2f>print</span><span style=color:#fdf4c1>(</span><span style=color:#fa5c4b>f</span><span style=color:#b8bb26>"当 N = </span><span style=color:#fdf4c1>{N_value_large}</span><span style=color:#b8bb26> 时，K 的值为: </span><span style=color:#fdf4c1>{result_K_large:.09f}</span><span style=color:#b8bb26>"</span><span style=color:#fdf4c1>)
</span></code></pre><pre style=color:#fdf4c1aa;background-color:#282828><code><span>当 N = 5 时，K 的值为: 0.607351770
</span><span>当 N = 10 时，K 的值为: 0.607253032
</span><span>当 N = 30 时，K 的值为: 0.607252935
</span></code></pre><p>我们取 $K \approx 0.607252935$ 来计算。<h3 id=dai-xu>待续</h3><p>下一部分会尝试把 CORDIC 算法推广到定点数，用 go 实现常用定点数三角函数 <code>sin</code>/<code>cos</code>/<code>tan</code>。</article><p class=tags-data><a href=/tags/ding-dian-shu>/定点数/</a> <a href=/tags/suan-fa>/算法/</a> <a href=/tags/shu-xue>/数学/</a> <a href=/tags/shu-zhi-ji-suan>/数值计算/</a></p><script data-repo-id="MDEwOlJlcG9zaXRvcnkzOTg0ODYyMTg=" async crossorigin data-category=Announcements data-category-id=DIC_kwDOF8Bqys4Cegmn data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-mapping=pathname data-reactions-enabled=1 data-repo=nnnewb/nnnewb.github.io data-strict=0 data-theme=noborder_light id=giscus_script src=https://giscus.app/client.js></script></main><footer><hr><div id=footer-container><div><p style=text-align:center>Copyright © 2018-2024 weakptr <a href=mailto:weak_ptr@outlook.com>&lt;weak_ptr@outlook.com></a><p style=text-align:center>Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme, <a rel="noopener noreferrer" href=https://speyll.github.io/suCSS/ target=_blank>suCSS</a> framework & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a>, modified by <a rel="noopener noreferrer" href=https://github.com/nnnewb/ target=_blank>nnnewb</a>.<p style=text-align:center>Theme and color theme licensed under <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a>.</div></div></footer>