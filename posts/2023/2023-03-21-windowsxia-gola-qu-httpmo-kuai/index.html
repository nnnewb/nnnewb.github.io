<!doctype html><html lang=zh><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>Windows下go拉取http模块</title><meta content=Windows下go拉取http模块 name=title><meta content=一点点从这个世界上消失。 name=description><meta content=website property=og:type><meta content=https://nnnewb.github.io/posts/2023/2023-03-21-windowsxia-gola-qu-httpmo-kuai/ property=og:url><meta content="weakptr's blog" property=og:site_name><meta content=Windows下go拉取http模块 property=og:title><meta content=一点点从这个世界上消失。 property=og:description><meta content=https://nnnewb.github.io/image/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://nnnewb.github.io/posts/2023/2023-03-21-windowsxia-gola-qu-httpmo-kuai/ property=twitter:url><meta content=Windows下go拉取http模块 property=twitter:title><meta content=一点点从这个世界上消失。 property=twitter:description><meta content=https://nnnewb.github.io/image/favicon.ico property=twitter:image><link href=https://nnnewb.github.io/posts/2023/2023-03-21-windowsxia-gola-qu-httpmo-kuai/ rel=canonical><link rel="shortcut icon" href=https://nnnewb.github.io/image/favicon.ico type=image/x-icon><link href=https://nnnewb.github.io/css/reset.css rel=stylesheet><link href=https://nnnewb.github.io/css/pallete.css rel=stylesheet><link href=https://nnnewb.github.io/css/suCSS.css rel=stylesheet><link href=https://nnnewb.github.io/archive.css rel=stylesheet><link href=https://nnnewb.github.io/style.css rel=stylesheet><script defer src=https://nnnewb.github.io/js/script.js></script><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y rel=stylesheet><script crossorigin defer integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js></script><script crossorigin defer integrity=sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js></script><script crossorigin defer integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe src=https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            // customised options
            // • auto-render specific keys, e.g.:
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: false }
            ],
            // • rendering keys, e.g.:
            throwOnError: true
        });
    });</script><script src=https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js></script><script>document.addEventListener('DOMContentLoaded', function () {
        // 查找所有具有 'pre' 标签且类名为 'language-mermaid' 的元素
        const mermaidElements = document.getElementsByClassName('language-mermaid');
        for (let i = 0; i < mermaidElements.length; i++) {
            const el = mermaidElements.item(i);
            if (el.tagName === "PRE" && !el.classList.contains('mermaid')) {
                el.innerHTML = el.textContent;
                el.classList.add('mermaid');
            }
        }

        mermaid.initialize({ startOnLoad: true, theme: 'dark', });
    })</script><script>if (window.location.hostname.toLowerCase() !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?dbb9df33a2de52aede8bccd84a7493ad";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    }</script><link href=https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Medium/result.css rel=stylesheet><link href=https://chinese-fonts-cdn.deno.dev/packages/maple-mono-cn/dist/MapleMono-CN-Regular/result.css rel=stylesheet><body><header><nav id=nav-bar><a href=/> 首页 </a>  /  <a href=/posts/> 文章 </a>  /  <a href=/categories/> 分类 </a>  /  <a href=/tags/> 标签 </a>  /  <a href=/search/> 搜索 </a>  /  <div><input id=theme-toggle style=display:none type=checkbox><label for=theme-toggle id=theme-toggle-label><svg class=icons id=theme-icon><use href=https://nnnewb.github.io/icons.svg#lightMode></use></svg></label><audio id=theme-sound><source src=https://nnnewb.github.io/click.ogg type=audio/ogg></audio></div></nav></header><main><h1>Windows下go拉取http模块</h1><p class=author-line>作于：2023-03-21 17:21 ，最后更新于：2024-09-24 00:00 ，预计阅读时间 3 分钟<article><h2 id=xian-xiang>现象</h2><p>内网搭建的 gitlab 没有开启 https，只有 http 服务。允许通过 8022 端口 SSH 协议 clone 或者 80 HTTP 协议。<p>但是 go 默认不支持（不然就没现在这么多壁画了）。<h2 id=fang-fa>方法</h2><h3 id=1-bian-ji-ssh-config>1. 编辑 ~/.ssh/config</h3><p>先 <code>gvim ~/.ssh/config</code> 打开 ssh 配置，添加一个 gitlab 的 ssh 配置。<pre style=color:#fdf4c1aa;background-color:#282828><code><span>Host &lt;gitlab的ip>
</span><span>    HostName &lt;gitlab的ip>
</span><span>    Port &lt;gitlab的ssh端口>
</span><span>    User git
</span><span>    IdentityFile &lt;你的ssh私钥路径>
</span></code></pre><p>这一步的目的是万一你的端口不是22的话，后续git配置还能读ssh配置选择正确的端口。<h3 id=2-bian-ji-gitconfig>2. 编辑 ~/.gitconfig</h3><p>这一步的目的是让配置 <code>GOPRIVATE</code>、<code>GOINSECURE</code> 之后 go 走 http 协议下的时候替换成 ssh 协议。<p>直接用 http 也可以但是需要在 <code>go mod download</code> 时输入账密登录。<blockquote><p>只使用 http 不安全还麻烦，所以不推荐。<p>如果 gitlab 有 https 的话就不需要配置 GOINSECURE 。</blockquote><p>使用命令：<pre class=language-bash data-lang=bash style=color:#fdf4c1aa;background-color:#282828><code class=language-bash data-lang=bash><span style=color:#fdf4c1>git config --global url.</span><span style=color:#b8bb26>"git@&lt;GITLAB_HOST>:"</span><span style=color:#fdf4c1>.insteadOf </span><span style=color:#b8bb26>"https://GITLAB_HOST/"
</span></code></pre><p><strong>注意</strong><ul><li><code>&lt;GITLAB_HOST>:</code>后面的<code>:</code>别漏了，这样才能拼出 <code>git@github.com:nnnew/battery</code> 这样的合法地址。<li><code>"https://&lt;GITLAB_HOST>"</code> 如果是 http 协议，就改成 <code>http://</code> 开头，别写错。</ul><p>1、2步配置完成后应该就能使用 git 访问到仓库了，可以用命令测试。<pre class=language-bash data-lang=bash style=color:#fdf4c1aa;background-color:#282828><code class=language-bash data-lang=bash><span style=color:#fdf4c1>git ls-remote ssh://</span><span style=color:#fe8019>&lt;</span><span style=color:#fdf4c1>GITLAB_HOST</span><span style=color:#fe8019>></span><span style=color:#fdf4c1>/</span><span style=color:#fe8019>&lt;</span><span style=color:#fdf4c1>REPOSITORY</span><span style=color:#fe8019>>
</span></code></pre><p>成功会输出仓库的所有 tag/branch 信息。<h3 id=3-she-zhi-go-env>3. 设置 go env</h3><pre class=language-bash data-lang=bash style=color:#fdf4c1aa;background-color:#282828><code class=language-bash data-lang=bash><span style=color:#fdf4c1>go env -w GOPRIVATE=</span><span style=color:#b8bb26>"&lt;gitlab的ip>"
</span><span style=color:#fdf4c1>go env -w GOINSECURE=</span><span style=color:#b8bb26>"&lt;gitlab的ip>"
</span></code></pre><p>设置 <code>GOPRIVATE</code> 的目的是让 go 从私有 git 仓库拉代码。<p>设置 <code>GOINSECURE</code> 的目的是让 go 用 http 而不是 https 协议去拉代码。有 https 访问的情况下不用配。<p>理论上来说，也可以不设置 <code>GOINSECURE</code>，但是 <code>~/.gitconfig</code> 里配置 <code>insteadOf</code> 的时候要注意写 https 而不是 http，可以自己试试。<h3 id=4-la-dai-ma>4. 拉代码</h3><p>试试 <code>git clone</code> 一个私有仓库（http），如果没提示输入账密就成功那就ok了。要是不行就自己搜索下。<p>理论上来说接下来 <code>go mod download</code> 就不会有问题了。<h2 id=zong-jie>总结</h2><p>重新配了一遍发现还是 Windows 屁事多。</article><p class=tags-data><a href=/tags/golang>/golang/</a> <a href=/tags/git>/git/</a></p><script data-repo-id="MDEwOlJlcG9zaXRvcnkzOTg0ODYyMTg=" async crossorigin data-category=Announcements data-category-id=DIC_kwDOF8Bqys4Cegmn data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-mapping=pathname data-reactions-enabled=1 data-repo=nnnewb/nnnewb.github.io data-strict=0 data-theme=noborder_light id=giscus_script src=https://giscus.app/client.js></script></main><footer><hr><div id=footer-container><div><p style=text-align:center>Copyright © 2018-2024 weakptr <a href=mailto:weak_ptr@outlook.com>&lt;weak_ptr@outlook.com></a><p style=text-align:center>Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme, <a rel="noopener noreferrer" href=https://speyll.github.io/suCSS/ target=_blank>suCSS</a> framework & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a>, modified by <a rel="noopener noreferrer" href=https://github.com/nnnewb/ target=_blank>nnnewb</a>.<p style=text-align:center>Theme and color theme licensed under <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a>.</div></div></footer>